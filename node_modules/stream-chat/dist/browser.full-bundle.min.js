!function(e){"use strict";for(var t=function(e){for(var t,r=e.length,s=r%3,i=[],a=16383,c=0,u=r-s;c<u;c+=a)i.push(o(e,c,c+a>u?u:c+a));1===s?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")},n=[],r=[],s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=s.length;i<a;++i)n[i]=s[i],r[s.charCodeAt(i)]=i;function o(e,t,r){for(var s,i,a=[],o=t;o<r;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n[(i=s)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}function c(e){return"string"==typeof e}function u(e,t){return!!t&&c(e)}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63;var l=function(e){return t(new Uint8Array(function(e,t){var n=[];if(c(e)&&u(e,t)){for(var r=0,s=e.length;r<s;r++)if(e.charAt(r)){var i=t(e.charAt(r),r,e);n[r]=i}}else if(!c(e)&&!u(e,t))for(var a=0,o=e.length;a<o;a++)if(a in e){var l=t(e[a],a,e);n[a]=l}return n}(e,(function(e){return e.charCodeAt(0)}))))},h=function(e){var t,n,r,s={},i=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+s[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=i(r));return u};function d(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var i=e.apply(t,n);function a(e){d(i,r,s,a,o,"next",e)}function o(e){d(i,r,s,a,o,"throw",e)}a(void 0)}))}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var b,w,_=(b=function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",o=s.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var s=t&&t.prototype instanceof g?t:g,i=Object.create(s.prototype),a=new U(r||[]);return i._invoke=function(e,t,n){var r=h;return function(s,i){if(r===p)throw new Error("Generator is already running");if(r===f){if("throw"===s)throw i;return A()}for(n.method=s,n.arg=i;;){var a=n.delegate;if(a){var o=S(a,n);if(o){if(o===v)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?f:d,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h="suspendedStart",d="suspendedYield",p="executing",f="completed",v={};function g(){}function m(){}function y(){}var b={};b[i]=function(){return this};var w=Object.getPrototypeOf,_=w&&w(w(E([])));_&&_!==n&&r.call(_,i)&&(b=_);var k=y.prototype=g.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(s,i,a,o){var c=l(e[s],e,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,o)}))}o(c.arg)}var s;this._invoke=function(e,r){function i(){return new t((function(t,s){n(e,r,t,s)}))}return s=s?s.then(i,i):i()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var s=l(r,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var i=s.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function n(){for(;++s<e.length;)if(r.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:A}}function A(){return{value:t,done:!0}}return m.prototype=k.constructor=y,y.constructor=m,m.displayName=c(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,o,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},x(C.prototype),C.prototype[a]=function(){return this},e.AsyncIterator=C,e.async=function(t,n,r,s,i){void 0===i&&(i=Promise);var a=new C(u(t,n,r,s),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),c(k,o,"Generator"),k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(r,s){return o.type="throw",o.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var s=r.arg;R(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}},b(w={exports:{}},w.exports),w.exports),k=_,x=function(){function e(t,n,r){f(this,e),m(this,"id",void 0),m(this,"data",void 0),m(this,"client",void 0),this.client=t,this.id=n,this.data=r}var t,n,r,s,i,a;return g(e,[{key:"create",value:(a=p(k.mark((function e(){var t,n,r,s,i,a,o,c,u,l,h;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l={id:this.id,message_template:null===(t=this.data)||void 0===t?void 0:t.message_template,segment_ids:null===(n=this.data)||void 0===n?void 0:n.segment_ids,sender_id:null===(r=this.data)||void 0===r?void 0:r.sender_id,sender_mode:null===(s=this.data)||void 0===s?void 0:s.sender_mode,channel_template:null===(i=this.data)||void 0===i?void 0:i.channel_template,create_channels:null===(a=this.data)||void 0===a?void 0:a.create_channels,description:null===(o=this.data)||void 0===o?void 0:o.description,name:null===(c=this.data)||void 0===c?void 0:c.name,user_ids:null===(u=this.data)||void 0===u?void 0:u.user_ids},e.next=3,this.client.createCampaign(l);case 3:return h=e.sent,this.id=h.campaign.id,this.data=h.campaign,e.abrupt("return",h);case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"verifyCampaignId",value:function(){if(!this.id)throw new Error("Campaign id is missing. Either create the campaign using campaign.create() or set the id during instantiation - const campaign = client.campaign(id)")}},{key:"start",value:(i=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.startCampaign(this.id,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"update",value:(s=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.updateCampaign(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"delete",value:(r=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.deleteCampaign(this.id);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stop",value:(n=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.stopCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"get",value:(t=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.getCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function O(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){if(e){if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(e,t):void 0}}function E(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||U(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){return function(){return e.apply(t,arguments)}}const{toString:P}=Object.prototype,{getPrototypeOf:I}=Object,L=(T=Object.create(null),e=>{const t=P.call(e);return T[t]||(T[t]=t.slice(8,-1).toLowerCase())});var T;const D=e=>(e=e.toLowerCase(),t=>L(t)===e),M=e=>t=>typeof t===e,{isArray:j}=Array,F=M("undefined");const N=D("ArrayBuffer");const q=M("string"),B=M("function"),V=M("number"),H=e=>null!==e&&"object"==typeof e,W=e=>{if("object"!==L(e))return!1;const t=I(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},z=D("Date"),Q=D("File"),J=D("Blob"),G=D("FileList"),K=D("URLSearchParams");function $(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,s;if("object"!=typeof e&&(e=[e]),j(e))for(r=0,s=e.length;r<s;r++)t.call(null,e[r],r,e);else{const s=n?Object.getOwnPropertyNames(e):Object.keys(e),i=s.length;let a;for(r=0;r<i;r++)a=s[r],t.call(null,e[a],a,e)}}function X(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,s=n.length;for(;s-- >0;)if(r=n[s],t===r.toLowerCase())return r;return null}const Y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Z=e=>!F(e)&&e!==Y;const ee=(te="undefined"!=typeof Uint8Array&&I(Uint8Array),e=>te&&e instanceof te);var te;const ne=D("HTMLFormElement"),re=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),se=D("RegExp"),ie=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};$(n,((n,s)=>{let i;!1!==(i=t(n,s,e))&&(r[s]=i||n)})),Object.defineProperties(e,r)},ae="abcdefghijklmnopqrstuvwxyz",oe="0123456789",ce={DIGIT:oe,ALPHA:ae,ALPHA_DIGIT:ae+ae.toUpperCase()+oe};const ue=D("AsyncFunction");var le={isArray:j,isArrayBuffer:N,isBuffer:function(e){return null!==e&&!F(e)&&null!==e.constructor&&!F(e.constructor)&&B(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||B(e.append)&&("formdata"===(t=L(e))||"object"===t&&B(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&N(e.buffer),t},isString:q,isNumber:V,isBoolean:e=>!0===e||!1===e,isObject:H,isPlainObject:W,isUndefined:F,isDate:z,isFile:Q,isBlob:J,isRegExp:se,isFunction:B,isStream:e=>H(e)&&B(e.pipe),isURLSearchParams:K,isTypedArray:ee,isFileList:G,forEach:$,merge:function e(){const{caseless:t}=Z(this)&&this||{},n={},r=(r,s)=>{const i=t&&X(n,s)||s;W(n[i])&&W(r)?n[i]=e(n[i],r):W(r)?n[i]=e({},r):j(r)?n[i]=r.slice():n[i]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&$(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>($(t,((t,r)=>{n&&B(t)?e[r]=A(t,n):e[r]=t}),{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let s,i,a;const o={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)a=s[i],r&&!r(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==n&&I(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:L,kindOfTest:D,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(j(e))return e;let t=e.length;if(!V(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:ne,hasOwnProperty:re,hasOwnProp:re,reduceDescriptors:ie,freezeMethods:e=>{ie(e,((t,n)=>{if(B(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];B(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return j(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:X,global:Y,isContextDefined:Z,ALPHABET:ce,generateString:(e=16,t=ce.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&B(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(H(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const s=j(e)?[]:{};return $(e,((e,t)=>{const i=n(e,r+1);!F(i)&&(s[t]=i)})),t[r]=void 0,s}}return e};return n(e,0)},isAsyncFn:ue,isThenable:e=>e&&(H(e)||B(e))&&B(e.then)&&B(e.catch)};function he(e,t,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s)}le.inherits(he,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:le.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const de=he.prototype,pe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{pe[e]={value:e}})),Object.defineProperties(he,pe),Object.defineProperty(de,"isAxiosError",{value:!0}),he.from=(e,t,n,r,s,i)=>{const a=Object.create(de);return le.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),he.call(a,e.message,t,n,r,s),a.cause=e,a.name=e.name,i&&Object.assign(a,i),a};function fe(e){return le.isPlainObject(e)||le.isArray(e)}function ve(e){return le.endsWith(e,"[]")?e.slice(0,-2):e}function ge(e,t,n){return e?e.concat(t).map((function(e,t){return e=ve(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const me=le.toFlatObject(le,{},null,(function(e){return/^is[A-Z]/.test(e)}));function ye(e,t,n){if(!le.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=le.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!le.isUndefined(t[e])}))).metaTokens,s=n.visitor||u,i=n.dots,a=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&le.isSpecCompliantForm(t);if(!le.isFunction(s))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(le.isDate(e))return e.toISOString();if(!o&&le.isBlob(e))throw new he("Blob is not supported. Use a Buffer instead.");return le.isArrayBuffer(e)||le.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,s){let o=e;if(e&&!s&&"object"==typeof e)if(le.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(le.isArray(e)&&function(e){return le.isArray(e)&&!e.some(fe)}(e)||(le.isFileList(e)||le.endsWith(n,"[]"))&&(o=le.toArray(e)))return n=ve(n),o.forEach((function(e,r){!le.isUndefined(e)&&null!==e&&t.append(!0===a?ge([n],r,i):null===a?n:n+"[]",c(e))})),!1;return!!fe(e)||(t.append(ge(s,n,i),c(e)),!1)}const l=[],h=Object.assign(me,{defaultVisitor:u,convertValue:c,isVisitable:fe});if(!le.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!le.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),le.forEach(n,(function(n,i){!0===(!(le.isUndefined(n)||null===n)&&s.call(t,n,le.isString(i)?i.trim():i,r,h))&&e(n,r?r.concat(i):[i])})),l.pop()}}(e),t}function be(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function we(e,t){this._pairs=[],e&&ye(e,this,t)}const _e=we.prototype;function ke(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function xe(e,t,n){if(!t)return e;const r=n&&n.encode||ke,s=n&&n.serialize;let i;if(i=s?s(t,n):le.isURLSearchParams(t)?t.toString():new we(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}_e.append=function(e,t){this._pairs.push([e,t])},_e.toString=function(e){const t=e?function(t){return e.call(this,t,be)}:be;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class Ce{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){le.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}var Se={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var Oe={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:we,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function Re(e){function t(e,n,r,s){let i=e[s++];const a=Number.isFinite(+i),o=s>=e.length;if(i=!i&&le.isArray(r)?r.length:i,o)return le.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!a;r[i]&&le.isObject(r[i])||(r[i]=[]);return t(e,n,r[i],s)&&le.isArray(r[i])&&(r[i]=function(e){const t={},n=Object.keys(e);let r;const s=n.length;let i;for(r=0;r<s;r++)i=n[r],t[i]=e[i];return t}(r[i])),!a}if(le.isFormData(e)&&le.isFunction(e.entries)){const n={};return le.forEachEntry(e,((e,r)=>{t(function(e){return le.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const Ue={transitional:Se,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=le.isObject(e);s&&le.isHTMLForm(e)&&(e=new FormData(e));if(le.isFormData(e))return r&&r?JSON.stringify(Re(e)):e;if(le.isArrayBuffer(e)||le.isBuffer(e)||le.isStream(e)||le.isFile(e)||le.isBlob(e))return e;if(le.isArrayBufferView(e))return e.buffer;if(le.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ye(e,new Oe.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=le.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ye(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),function(e,t,n){if(le.isString(e))try{return(t||JSON.parse)(e),le.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Ue.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&le.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw he.from(e,he.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Oe.classes.FormData,Blob:Oe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};le.forEach(["delete","get","head","post","put","patch"],(e=>{Ue.headers[e]={}}));const Ee=le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const Ae=Symbol("internals");function Pe(e){return e&&String(e).trim().toLowerCase()}function Ie(e){return!1===e||null==e?e:le.isArray(e)?e.map(Ie):String(e)}function Le(e,t,n,r,s){return le.isFunction(r)?r.call(this,t,n):(s&&(t=n),le.isString(t)?le.isString(r)?-1!==t.indexOf(r):le.isRegExp(r)?r.test(t):void 0:void 0)}class Te{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function s(e,t,n){const s=Pe(t);if(!s)throw new Error("header name must be a non-empty string");const i=le.findKey(r,s);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=Ie(e))}const i=(e,t)=>le.forEach(e,((e,n)=>s(e,n,t)));return le.isPlainObject(e)||e instanceof this.constructor?i(e,t):le.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?i((e=>{const t={};let n,r,s;return e&&e.split("\n").forEach((function(e){s=e.indexOf(":"),n=e.substring(0,s).trim().toLowerCase(),r=e.substring(s+1).trim(),!n||t[n]&&Ee[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&s(t,e,n),this}get(e,t){if(e=Pe(e)){const n=le.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(le.isFunction(t))return t.call(this,e,n);if(le.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Pe(e)){const n=le.findKey(this,e);return!(!n||void 0===this[n]||t&&!Le(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function s(e){if(e=Pe(e)){const s=le.findKey(n,e);!s||t&&!Le(0,n[s],s,t)||(delete n[s],r=!0)}}return le.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const s=t[n];e&&!Le(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const t=this,n={};return le.forEach(this,((r,s)=>{const i=le.findKey(n,s);if(i)return t[i]=Ie(r),void delete t[s];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(s):String(s).trim();a!==s&&delete t[s],t[a]=Ie(r),n[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return le.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&le.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[Ae]=this[Ae]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Pe(e);t[r]||(!function(e,t){const n=le.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,s){return this[r].call(this,t,e,n,s)},configurable:!0})}))}(n,e),t[r]=!0)}return le.isArray(e)?e.forEach(r):r(e),this}}function De(e,t){const n=this||Ue,r=t||n,s=Te.from(r.headers);let i=r.data;return le.forEach(e,(function(e){i=e.call(n,i,s.normalize(),t?t.status:void 0)})),s.normalize(),i}function Me(e){return!(!e||!e.__CANCEL__)}function je(e,t,n){he.call(this,null==e?"canceled":e,he.ERR_CANCELED,t,n),this.name="CanceledError"}Te.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),le.reduceDescriptors(Te.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),le.freezeMethods(Te),le.inherits(je,he,{__CANCEL__:!0});var Fe=Oe.isStandardBrowserEnv?{write:function(e,t,n,r,s,i){const a=[];a.push(e+"="+encodeURIComponent(t)),le.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),le.isString(r)&&a.push("path="+r),le.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function Ne(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var qe=Oe.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=le.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function Be(e,t){let n=0;const r=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let s,i=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),u=r[a];s||(s=c),n[i]=o,r[i]=c;let l=a,h=0;for(;l!==i;)h+=n[l++],l%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),c-s<t)return;const d=u&&c-u;return d?Math.round(1e3*h/d):void 0}}(50,250);return s=>{const i=s.loaded,a=s.lengthComputable?s.total:void 0,o=i-n,c=r(o);n=i;const u={loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&i<=a?(a-i)/c:void 0,event:s};u[t?"download":"upload"]=!0,e(u)}}const Ve={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const s=Te.from(e.headers).normalize(),i=e.responseType;let a,o;function c(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}le.isFormData(r)&&(Oe.isStandardBrowserEnv||Oe.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.getContentType(/^\s*multipart\/form-data/)?le.isString(o=s.getContentType())&&s.setContentType(o.replace(/^\s*(multipart\/form-data);+/,"$1")):s.setContentType("multipart/form-data"));let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.set("Authorization","Basic "+btoa(t+":"+n))}const l=Ne(e.baseURL,e.url);function h(){if(!u)return;const r=Te.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new he("Request failed with status code "+n.status,[he.ERR_BAD_REQUEST,he.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),c()}),(function(e){n(e),c()}),{data:i&&"text"!==i&&"json"!==i?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),xe(l,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(h)},u.onabort=function(){u&&(n(new he("Request aborted",he.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new he("Network Error",he.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||Se;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new he(t,r.clarifyTimeoutError?he.ETIMEDOUT:he.ECONNABORTED,e,u)),u=null},Oe.isStandardBrowserEnv){const t=qe(l)&&e.xsrfCookieName&&Fe.read(e.xsrfCookieName);t&&s.set(e.xsrfHeaderName,t)}void 0===r&&s.setContentType(null),"setRequestHeader"in u&&le.forEach(s.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),le.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),i&&"json"!==i&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",Be(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",Be(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{u&&(n(!t||t.type?new je(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const d=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(l);d&&-1===Oe.protocols.indexOf(d)?n(new he("Unsupported protocol "+d+":",he.ERR_BAD_REQUEST,e)):u.send(r||null)}))}};le.forEach(Ve,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const He=e=>`- ${e}`,We=e=>le.isFunction(e)||null===e||!1===e;var ze=e=>{e=le.isArray(e)?e:[e];const{length:t}=e;let n,r;const s={};for(let i=0;i<t;i++){let t;if(n=e[i],r=n,!We(n)&&(r=Ve[(t=String(n)).toLowerCase()],void 0===r))throw new he(`Unknown adapter '${t}'`);if(r)break;s[t||"#"+i]=r}if(!r){const e=Object.entries(s).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new he("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(He).join("\n"):" "+He(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function Qe(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new je(null,e)}function Je(e){Qe(e),e.headers=Te.from(e.headers),e.data=De.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ze(e.adapter||Ue.adapter)(e).then((function(t){return Qe(e),t.data=De.call(e,e.transformResponse,t),t.headers=Te.from(t.headers),t}),(function(t){return Me(t)||(Qe(e),t&&t.response&&(t.response.data=De.call(e,e.transformResponse,t.response),t.response.headers=Te.from(t.response.headers))),Promise.reject(t)}))}const Ge=e=>e instanceof Te?e.toJSON():e;function Ke(e,t){t=t||{};const n={};function r(e,t,n){return le.isPlainObject(e)&&le.isPlainObject(t)?le.merge.call({caseless:n},e,t):le.isPlainObject(t)?le.merge({},t):le.isArray(t)?t.slice():t}function s(e,t,n){return le.isUndefined(t)?le.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function i(e,t){if(!le.isUndefined(t))return r(void 0,t)}function a(e,t){return le.isUndefined(t)?le.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,s,i){return i in t?r(n,s):i in e?r(void 0,n):void 0}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>s(Ge(e),Ge(t),!0)};return le.forEach(Object.keys(Object.assign({},e,t)),(function(r){const i=c[r]||s,a=i(e[r],t[r],r);le.isUndefined(a)&&i!==o||(n[r]=a)})),n}const $e="1.6.0",Xe={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Xe[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Ye={};Xe.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.0] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,s,i)=>{if(!1===e)throw new he(r(s," has been removed"+(t?" in "+t:"")),he.ERR_DEPRECATED);return t&&!Ye[s]&&(Ye[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,s,i)}};var Ze={assertOptions:function(e,t,n){if("object"!=typeof e)throw new he("options must be an object",he.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const i=r[s],a=t[i];if(a){const t=e[i],n=void 0===t||a(t,i,e);if(!0!==n)throw new he("option "+i+" must be "+n,he.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new he("Unknown option "+i,he.ERR_BAD_OPTION)}},validators:Xe};const et=Ze.validators;class tt{constructor(e){this.defaults=e,this.interceptors={request:new Ce,response:new Ce}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ke(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:s}=t;void 0!==n&&Ze.assertOptions(n,{silentJSONParsing:et.transitional(et.boolean),forcedJSONParsing:et.transitional(et.boolean),clarifyTimeoutError:et.transitional(et.boolean)},!1),null!=r&&(le.isFunction(r)?t.paramsSerializer={serialize:r}:Ze.assertOptions(r,{encode:et.function,serialize:et.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=s&&le.merge(s.common,s[t.method]);s&&le.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete s[e]})),t.headers=Te.concat(i,s);const a=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,h=0;if(!o){const e=[Je.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),l=e.length,u=Promise.resolve(t);h<l;)u=u.then(e[h++],e[h++]);return u}l=a.length;let d=t;for(h=0;h<l;){const e=a[h++],t=a[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{u=Je.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,l=c.length;h<l;)u=u.then(c[h++],c[h++]);return u}getUri(e){return xe(Ne((e=Ke(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}le.forEach(["delete","get","head","options"],(function(e){tt.prototype[e]=function(t,n){return this.request(Ke(n||{},{method:e,url:t,data:(n||{}).data}))}})),le.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,s){return this.request(Ke(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}tt.prototype[e]=t(),tt.prototype[e+"Form"]=t(!0)}));class nt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,s){n.reason||(n.reason=new je(e,r,s),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new nt((function(t){e=t})),cancel:e}}}const rt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(rt).forEach((([e,t])=>{rt[t]=e}));const st=function e(t){const n=new tt(t),r=A(tt.prototype.request,n);return le.extend(r,tt.prototype,n,{allOwnKeys:!0}),le.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Ke(t,n))},r}(Ue);st.Axios=tt,st.CanceledError=je,st.CancelToken=nt,st.isCancel=Me,st.VERSION=$e,st.toFormData=ye,st.AxiosError=he,st.Cancel=st.CanceledError,st.all=function(e){return Promise.all(e)},st.spread=function(e){return function(t){return e.apply(null,t)}},st.isAxiosError=function(e){return le.isObject(e)&&!0===e.isAxiosError},st.mergeConfig=Ke,st.AxiosHeaders=Te,st.formToJSON=e=>Re(le.isHTMLForm(e)?new FormData(e):e),st.getAdapter=ze,st.HttpStatusCode=rt,st.default=st;function it(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,i=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw s}}return i}}(e,t)||U(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var at="object"==typeof self?self.FormData:window.FormData;function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ut(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){o=!0,i=e})),f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ht(e,t){e.then().catch((function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)}))}var dt=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function pt(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var ft={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function vt(e,t,n){var r,s=new at;return null!==(r=e)&&"object"===S(r)&&(r.readable||"function"==typeof r._read)||function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}(e)||function(e){return"undefined"!=typeof window&&"File"in window&&e instanceof File}(e)||function(e){return"undefined"!=typeof window&&"Blob"in window&&e instanceof Blob}(e)?t?s.append("file",e,t):s.append("file",e):s.append("file",{uri:e,name:t||e.split("/").reverse()[0],contentType:n||void 0,type:n||void 0}),s}function gt(e){var t,n=[],r=ut(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var s=t.value,i=Object.entries(s);i.length>1&&console.warn("client._buildSort() - multiple fields in a single sort object detected. Object's field order is not guaranteed");for(var a=0,o=i;a<o.length;a++){var c=it(o[a],2),u=c[0],l=c[1];n.push({field:u,direction:l})}}}catch(e){r.e(e)}finally{r.f()}return n}function mt(e){var t=Math.min(500+2e3*e,25e3),n=Math.min(Math.max(250,2e3*(e-1)),25e3);return Math.floor(Math.random()*(t-n)+n)}function yt(){return(e=function(e){var t=new Uint8Array(e);return kt(t),t}(16))[6]=15&e[6]|64,e[8]=191&e[8]|128,bt(e.subarray(0,4))+"-"+bt(e.subarray(4,6))+"-"+bt(e.subarray(6,8))+"-"+bt(e.subarray(8,10))+"-"+bt(e.subarray(10,16));var e}function bt(e){for(var t="",n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}function wt(e){for(var t=Math.pow(2,8*e.byteLength/e.length),n=0;n<e.length;n++)e[n]=Math.random()*t}var _t,kt="undefined"!=typeof crypto&&void 0!==(null===(_t=crypto)||void 0===_t?void 0:_t.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):wt;function xt(e){var t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}))}catch(e){return{error:"failed to serialize the error"}}return t}function Ct(e){"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function St(e){"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}var Ot=function(e){var t=[];for(var n in e)void 0!==e[n]&&(Array.isArray(e[n])||"object"===S(e[n])?t.push("".concat(n,"=").concat(encodeURIComponent(JSON.stringify(e[n])))):t.push("".concat(n,"=").concat(encodeURIComponent(e[n]))));return t.join("&")};function Rt(e){return ct(ct({},e),{},{__html:e.html,pinned_at:e.pinned_at?new Date(e.pinned_at):null,created_at:e.created_at?new Date(e.created_at):new Date,updated_at:e.updated_at?new Date(e.updated_at):new Date,deleted_at:e.deleted_at?new Date(e.deleted_at):null,status:e.status||"received",reaction_groups:At(e.reaction_groups,e.reaction_counts,e.reaction_scores)})}var Ut=function(e){var t=e.needle,n=e.sortedArray,r=e.selectKey,s=e.selectValueToCompare,i=void 0===s?function(e){return e}:s,a=e.sortDirection,o=void 0===a?"ascending":a;if(!n.length)return 0;for(var c=0,u=n.length-1,l=0,h=i(t);c<=u;){var d=i(n[l=Math.round((c+u)/2)]);"ascending"===o&&h<d||"descending"===o&&h>=d?u=l-1:c=l+1}if(r)for(var p=r(t),f="ascending"===o?-1:1,v=c+f;0<=v&&v<n.length&&i(n[v])===h;v+=f)if(r(n[v])===p)return v;return c};function Et(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=s||n,a=E(e);if(n&&(a=a.filter((function(e){return!(e.id&&t.id===e.id)}))),0===a.length&&i)return a.concat(t);if(0===a.length)return a;var o=t[r].getTime(),c=a.at(-1)[r].getTime()<o;if(c&&i)return a.concat(t);if(c)return a;var u=Ut({needle:t,sortedArray:a,sortDirection:"ascending",selectValueToCompare:function(e){return e[r].getTime()},selectKey:function(e){return e.id}});return!n&&t.id&&a[u]&&t.id===a[u].id?(a[u]=t,a):(i&&a.splice(u,0,t),a)}function At(e,t,n){if(e)return e;if(t&&n){for(var r={},s=0,i=Object.keys(t);s<i.length;s++){var a=i[s];r[a]={count:t[a],sum_scores:n[a]}}return r}return null}var Pt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.leading,s=void 0===r||r,i=n.trailing,a=void 0!==i&&i,o=null,c=null;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(o)a&&(c=r);else{s&&e.apply(void 0,r);var u=function n(){if(c)return e.apply(void 0,E(c)),c=null,void(o=setTimeout(n,t));o=null};o=setTimeout(u,t)}}},It=function(e,t){if(!Array.isArray(e))return[];var n=new Set;return e.filter((function(e){var r,s="function"==typeof t?t(e):(r=e,t.split(".").reduce((function(e,t){if(e&&"object"===S(e)&&t in e)return e[t]}),r));return!n.has(s)&&(n.add(s),!0)}))};var Lt=function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=ct({},i.pagination);if(null==c||!c.created_at_around)return u;var l=new Date(c.created_at_around),h=[o[0],o.slice(-1)[0]],d=h[0],p=h[1],f=!(null==d||!d.created_at)&&new Date(d.created_at)>l,v=!(null==p||!p.created_at)&&new Date(p.created_at)<l,g=a>i.messages.length&&a>o.length,m=(a>i.messages.length||i.messages.length>=o.length)&&a>o.length;if(f)t=!1,r=!0,g&&(n=!1,s=!0);else if(v)n=!1,s=!0,g&&(t=!1,r=!0);else if(m)n=t=!1,r=s=!0;else{var y,b;r=(null==d?void 0:d.id)&&d.id===(null===(y=i.messages[0])||void 0===y?void 0:y.id),s=(null==p?void 0:p.id)&&p.id===(null===(b=i.messages.slice(-1)[0])||void 0===b?void 0:b.id);var w=Math.floor(o.length/2),_=function(e,t){for(var n=0,r=e.length-1;n<=r;){var s=Math.floor((n+r)/2),i=e[s].created_at;if(i){var a=new Date(i);if(a.getTime()===t.getTime())return s;a.getTime()<t.getTime()?n=s+1:r=s-1}else n+=1}return n}(o,l);-1!==_&&(t=w<=_,n=w>=_)}return r&&void 0!==t&&(u.hasPrev=t),s&&void 0!==n&&(u.hasNext=n),u},Tt=function(e){var t,n,r;return e.parentSet.messages.length<e.returnedPage.length?(null===(r=e.logger)||void 0===r||r.call(e,"error","Corrupted message set state: parent set size < returned page size"),e.parentSet.pagination):null!==(t=e.messagePaginationOptions)&&void 0!==t&&t.created_at_around?Lt(e):null!==(n=e.messagePaginationOptions)&&void 0!==n&&n.id_around?function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=ct({},i.pagination),l=(c||{}).id_around;if(!l)return u;var h=[o[0],o.slice(-1)[0]],d=h[0],p=h[1],f=(null==d?void 0:d.id)===(null===(t=i.messages[0])||void 0===t?void 0:t.id),v=(null==p?void 0:p.id)===(null===(n=i.messages.slice(-1)[0])||void 0===n?void 0:n.id),g=Math.floor(o.length/2);if((a>i.messages.length||i.messages.length>=o.length)&&a>o.length)s=r=!1,f=v=!0;else{if(!o[g])return u;if(o[g].id===l)r=s=!0;else{var m,y=[o.slice(0,g),o.slice(g)];r=s=!0;for(var b=0;b<y.length;b++)(m=y[b].find((function(e){return e.id===l})))&&0===b&&(r=!1),m&&1===b&&(s=!1)}}return f&&void 0!==r&&(u.hasPrev=r),v&&void 0!==s&&(u.hasNext=s),u}(e):function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=ct({},i.pagination),l=[o[0],o.slice(-1)[0]],h=l[0],d=l[1],p=(null==h?void 0:h.id)&&h.id===(null===(t=i.messages[0])||void 0===t?void 0:t.id),f=(null==d?void 0:d.id)&&d.id===(null===(n=i.messages.slice(-1)[0])||void 0===n?void 0:n.id),v=c&&(c.created_at_after_or_equal||c.created_at_after||c.id_gt||c.id_gte),g=void 0===c||c.created_at_before_or_equal||c.created_at_before||c.id_lt||c.id_lte||c.offset,m=!(v||g||null!=c&&c.id_around||null!=c&&c.created_at_around),y=o.length>=a;(void 0!==g||m)&&(r=y),void 0!==v&&(s=y);var b=0===o.length;return(p||b)&&void 0!==r&&(u.hasPrev=r),(f||b)&&void 0!==s&&(u.hasNext=s),u}(e)},Dt={},Mt=function(){var e=p(k.mark((function e(t){var n,r,s,i,a,o,c,u,l;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.channel,r=t.client,s=t.id,i=t.members,a=t.options,o=t.type,n||o){e.next=3;break}throw new Error("Channel or channel type have to be provided to query a channel.");case 3:if(c=n||r.channel(o,s,{members:i}),u=c.id?c.cid:i&&i.length?jt(c.type,i):void 0){e.next=7;break}throw new Error("Channel ID or channel members array have to be provided to query a channel.");case 7:if(!(l=Dt[u])){e.next=13;break}return e.next=11,l;case 11:e.next=20;break;case 13:return e.prev=13,Dt[u]=c.watch(a),e.next=17,Dt[u];case 17:return e.prev=17,delete Dt[u],e.finish(17);case 20:return e.abrupt("return",c);case 21:case"end":return e.stop()}}),e,null,[[13,,17,20]])})));return function(t){return e.apply(this,arguments)}}(),jt=function(e,t){if(t){var n=E(t).sort().join(",");if(n)return"".concat(e,":!members-").concat(n)}},Ft=function(e){if(!e)return!1;var t=e.state.membership;return!(null==t||!t.pinned_at)},Nt=function(e){if(!e)return!1;var t=e.state.membership;return!(null==t||!t.archived_at)},qt=function(e){return!!e&&"boolean"==typeof e.archived},Bt=function(e){var t,n,r=e.atIndex,s=e.sort,i=e.targetKey;if(!s)return null;var a=null;if(Array.isArray(s)){var o;a=null!==(o=s[r])&&void 0!==o?o:null}else{var c=0;for(var u in s){if(c===r){if(u!==i)return null;a=s;break}c++}}return null!==(t=null===(n=a)||void 0===n?void 0:n[i])&&void 0!==t?t:null},Vt=function(e){var t=Ht({sort:e});return"number"==typeof t&&1===Math.abs(t)},Ht=function(e){var t=e.sort;return Bt({atIndex:0,sort:t,targetKey:"pinned_at"})},Wt=function(e){var t,n=null,r=ut(e.channels);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(!Ft(s))break;"number"==typeof n?n++:n=0}}catch(e){r.e(e)}finally{r.f()}return n},zt=function(e){var t=e.channels,n=e.channelToMove,r=e.channelToMoveIndexWithinChannels,s=e.sort,i=null!=r?r:t.findIndex((function(e){return e.cid===n.cid})),a=i>=0,o=0===i,c=Vt(s),u=Ft(n);if(o||c&&u)return t;var l=E(t);a&&l.splice(i,1);var h=null;return c&&(h=Wt({channels:l})),l.splice("number"==typeof h?h+1:0,0,n),l},Qt={hasNext:!1,hasPrev:!1};function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt=function(){function e(t){var n,r=this;f(this,e),m(this,"_channel",void 0),m(this,"watcher_count",void 0),m(this,"typing",void 0),m(this,"read",void 0),m(this,"pinnedMessages",void 0),m(this,"pending_messages",void 0),m(this,"threads",void 0),m(this,"mutedUsers",void 0),m(this,"watchers",void 0),m(this,"members",void 0),m(this,"unreadCount",void 0),m(this,"membership",void 0),m(this,"last_message_at",void 0),m(this,"isUpToDate",void 0),m(this,"messageSets",[]),m(this,"formatMessage",(function(e){return Rt(e)})),m(this,"setIsUpToDate",(function(e){r.isUpToDate=e})),m(this,"removeMessageFromArray",(function(e,t){var n=e.filter((function(e){return!(e.id&&t.id&&e.id===t.id)}));return{removed:n.length<e.length,result:n}})),m(this,"updateUserMessages",(function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var r,s=e[n];(null===(r=s.user)||void 0===r?void 0:r.id)===t.id&&(e[n]=Gt(Gt({},s),{},{user:t}))}};for(var n in r.messageSets.forEach((function(n){return t(n.messages,e)})),r.threads)t(r.threads[n],e);t(r.pinnedMessages,e)})),m(this,"deleteUserMessages",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<e.length;r++){var s,i=e[r];(null===(s=i.user)||void 0===s?void 0:s.id)===t.id&&(e[r]=n?{cid:i.cid,created_at:i.created_at,deleted_at:t.deleted_at,id:i.id,latest_reactions:[],mentioned_users:[],own_reactions:[],parent_id:i.parent_id,reply_count:i.reply_count,status:i.status,thread_participants:i.thread_participants,type:"deleted",updated_at:i.updated_at,user:i.user}:Gt(Gt({},i),{},{type:"deleted",deleted_at:t.deleted_at?new Date(t.deleted_at):null}))}};for(var s in r.messageSets.forEach((function(r){return n(r.messages,e,t)})),r.threads)n(r.threads[s],e,t);n(r.pinnedMessages,e,t)})),this._channel=t,this.watcher_count=0,this.typing={},this.read={},this.initMessages(),this.pinnedMessages=[],this.pending_messages=[],this.threads={},this.mutedUsers=[],this.watchers={},this.members={},this.membership={},this.unreadCount=0,this.isUpToDate=!0,this.last_message_at=null!=(null==t||null===(n=t.state)||void 0===n?void 0:n.last_message_at)?new Date(t.state.last_message_at):null}var t;return g(e,[{key:"messages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isCurrent}));this.messageSets[t].messages=e}},{key:"latestMessages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isLatest})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isLatest}));this.messageSets[t].messages=e}},{key:"messagePagination",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.pagination)||Qt}},{key:"addMessageSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"latest";return this.addMessagesSorted([e],t,!1,n,r)}},{key:"addMessagesSorted",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"current",i=this.findTargetMessageSet(e,r,s),a=i.messagesToAdd,o=i.targetMessageSetIndex,c=0;c<a.length;c+=1){var u=a[c].shadowed;if(!u){var l,h=a[c].created_at instanceof Date,d=void 0;if(h)d=a[c];else(d=this.formatMessage(a[c])).user&&null!==(l=this._channel)&&void 0!==l&&l.cid&&this._channel.getClient().state.updateUserReference(d.user,this._channel.cid),n&&d.id&&this.threads[d.id]&&delete this.threads[d.id],this.last_message_at||(this.last_message_at=new Date(d.created_at.getTime())),d.created_at.getTime()>this.last_message_at.getTime()&&(this.last_message_at=new Date(d.created_at.getTime()));var p=d.parent_id;if(p&&!d.show_in_channel||-1===o||(this.messageSets[o].messages=this._addToMessageList(this.messageSets[o].messages,d,t,"created_at",r)),p&&!n){var f=this.threads[p]||[];this.threads[p]=this._addToMessageList(f,d,t,"created_at",r)}}}return{messageSet:this.messageSets[o]}}},{key:"addPinnedMessages",value:function(e){for(var t=0;t<e.length;t+=1)this.addPinnedMessage(e[t])}},{key:"addPinnedMessage",value:function(e){this.pinnedMessages=this._addToMessageList(this.pinnedMessages,this.formatMessage(e),!1,"pinned_at")}},{key:"removePinnedMessage",value:function(e){var t=this.removeMessageFromArray(this.pinnedMessages,e).result;this.pinnedMessages=t}},{key:"addReaction",value:function(e,t,n){var r=this;if(t){var s=t;return this._updateMessage(t,(function(t){return s.own_reactions=r._addOwnReactionToMessage(t.own_reactions,e,n),r.formatMessage(s)})),s}}},{key:"_addOwnReactionToMessage",value:function(e,t,n){return e=(e=n?[]:this._removeOwnReactionFromMessage(e,t))||[],this._channel.getClient().userID===t.user_id&&e.push(t),e}},{key:"_removeOwnReactionFromMessage",value:function(e,t){return e?e.filter((function(e){return e.user_id!==t.user_id||e.type!==t.type})):e}},{key:"removeReaction",value:function(e,t){var n=this;if(t){var r=t;return this._updateMessage(t,(function(t){return r.own_reactions=n._removeOwnReactionFromMessage(t.own_reactions,e),n.formatMessage(r)})),r}}},{key:"_updateQuotedMessageReferences",value:function(e){var t=this,n=e.message,r=e.remove,s=function(e){var s=e.reduce((function(e,t){var s,i,a;return t.quoted_message_id===n.id&&e.push(Gt(Gt({},Gt(Gt({},s=t),{},{created_at:s.created_at.toISOString(),pinned_at:null===(i=s.pinned_at)||void 0===i?void 0:i.toISOString(),updated_at:null===(a=s.updated_at)||void 0===a?void 0:a.toISOString()})),{},{quoted_message:r?Gt(Gt({},n),{},{attachments:[]}):n})),e}),[]);t.addMessagesSorted(s,!0)};n.parent_id?n.parent_id&&this.threads[n.parent_id]&&s(this.threads[n.parent_id]):this.messageSets.forEach((function(e){return s(e.messages)}))}},{key:"removeQuotedMessageReferences",value:function(e){this._updateQuotedMessageReferences({message:e,remove:!0})}},{key:"_updateMessage",value:function(e,t){var n=e.parent_id,r=e.show_in_channel,s=e.pinned;if(n&&this.threads[n]){var i=this.threads[n],a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i[a]=t(i[a]),this.threads[n]=i)}if(!r&&!n||r){var o=this.findMessageSetIndex(e);if(-1!==o){var c=this.messageSets[o].messages.findIndex((function(t){return t.id===e.id}));-1!==c&&(this.messageSets[o].messages[c]=t(this.messageSets[o].messages[c]))}}if(s){var u=this.pinnedMessages.findIndex((function(t){return t.id===e.id}));-1!==u&&(this.pinnedMessages[u]=t(this.pinnedMessages[u]))}}},{key:"_addToMessageList",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return Et(e,t,n,r,s)}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,s=n.result;this.threads[e.parent_id]=s,t=r}else{var i,a=null!==(i=e.messageSetIndex)&&void 0!==i?i:this.findMessageSetIndex(e);if(-1!==a){var o=this.removeMessageFromArray(this.messageSets[a].messages,e),c=o.removed,u=o.result;this.messageSets[a].messages=u,t=c}}return t}},{key:"filterErrorMessages",value:function(){var e=this.latestMessages.filter((function(e){return"error"!==e.type}));this.latestMessages=e}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=it(n[t],2),s=r[0],i=r[1],a="string"==typeof i.received_at?new Date(i.received_at):i.received_at||new Date;e.getTime()-a.getTime()>7e3&&(delete this.typing[s],this._channel.getClient().dispatchEvent({cid:this._channel.cid,type:"typing.stop",user:{id:s}}))}}},{key:"clearMessages",value:function(){this.initMessages(),this.pinnedMessages=[]}},{key:"initMessages",value:function(){this.messageSets=[{messages:[],isLatest:!0,isCurrent:!0,pagination:Qt}]}},{key:"loadMessageIntoState",value:(t=p(k.mark((function e(t,n){var r,s,i,a,o,c,u=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>2&&void 0!==u[2]?u[2]:25,a=!1,o=!1,c=n||t,"latest"!==t){e.next=10;break}if(this.messages!==this.latestMessages){e.next=7;break}return e.abrupt("return");case 7:i=this.messageSets.findIndex((function(e){return e.isLatest})),e.next=11;break;case 10:i=this.findMessageSetIndex({id:c});case 11:if(-1!==i&&(this.switchToMessageSet(i),a=!0),o=!n||!(null===(r=this.threads[n])||void 0===r||!r.find((function(e){return e.id===t}))),!a||!o){e.next=15;break}return e.abrupt("return");case 15:if(a){e.next=18;break}return e.next=18,this._channel.query({messages:{id_around:c,limit:s}},"new");case 18:if(o||!n){e.next=21;break}return e.next=21,this._channel.getReplies(n,{id_around:t,limit:s});case 21:-1!==(i=this.findMessageSetIndex({id:c}))&&this.switchToMessageSet(i);case 23:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"findMessage",value:function(e,t){if(t){var n=this.threads[t];if(!n)return;return n.find((function(t){return t.id===e}))}var r=this.findMessageSetIndex({id:e});if(-1!==r)return this.messageSets[r].messages.find((function(t){return t.id===e}))}},{key:"switchToMessageSet",value:function(e){var t=this.messageSets.find((function(e){return e.isCurrent}));t&&(t.isCurrent=!1,this.messageSets[e].isCurrent=!0)}},{key:"areMessageSetsOverlap",value:function(e,t){return e.some((function(e){return t.find((function(t){return e.id===t.id}))}))}},{key:"findMessageSetIndex",value:function(e){return this.messageSets.findIndex((function(t){return!!t.messages.find((function(t){return t.id===e.id}))}))}},{key:"findTargetMessageSet",value:function(e){var t,n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",i=e;if(r){var a=this.messageSets.map((function(e,t){return t})).filter((function(t){return n.areMessageSetsOverlap(n.messageSets[t].messages,e)}));switch(s){case"new":a.length>0?t=a[0]:e.some((function(e){return!e.parent_id}))&&(this.messageSets.push({messages:[],isCurrent:!1,isLatest:!1,pagination:Qt}),t=this.messageSets.length-1);break;case"current":t=this.messageSets.findIndex((function(e){return e.isCurrent}));break;case"latest":t=this.messageSets.findIndex((function(e){return e.isLatest}));break;default:t=-1}var o=a.splice(0,1)[0],c=E(a);if(void 0!==o&&o!==t&&c.push(t),c.length>0){var u=this.messageSets[o],l=this.messageSets.filter((function(e,t){return-1!==c.indexOf(t)}));l.forEach((function(e){u.isLatest=u.isLatest||e.isLatest,u.isCurrent=u.isCurrent||e.isCurrent,u.pagination.hasPrev=e.messages[0].created_at<u.messages[0].created_at?e.pagination.hasPrev:u.pagination.hasPrev,u.pagination.hasNext=u.messages.slice(-1)[0].created_at<e.messages.slice(-1)[0].created_at?e.pagination.hasNext:u.pagination.hasNext,i=[].concat(E(i),E(e.messages))})),l.forEach((function(e){return n.messageSets.splice(n.messageSets.indexOf(e),1)}));var h=this.messageSets.findIndex((function(t){return n.areMessageSetsOverlap(t.messages,e)}));t=h}}else t=this.findMessageSetIndex(e[0]);return{targetMessageSetIndex:t,messagesToAdd:i}}}]),e}();function $t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Xt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function Xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var en=function(){function e(t,n,r,s){var i=this;f(this,e),m(this,"_client",void 0),m(this,"type",void 0),m(this,"id",void 0),m(this,"data",void 0),m(this,"_data",void 0),m(this,"cid",void 0),m(this,"listeners",void 0),m(this,"state",void 0),m(this,"initialized",void 0),m(this,"offlineMode",void 0),m(this,"lastKeyStroke",void 0),m(this,"lastTypingEvent",void 0),m(this,"isTyping",void 0),m(this,"disconnected",void 0),m(this,"push_preferences",void 0),m(this,"create",function(){var e=p(k.mark((function e(t){var n;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Zt(Zt({},t),{},{watch:!1,state:!1,presence:!1}),e.next=3,i.query(n,"latest");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"_callChannelListeners",(function(e){var t=i,n=[];t.listeners.all&&n.push.apply(n,E(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,E(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){var a=s[r];"string"!=typeof a&&a(e)}})),m(this,"_channelURL",(function(){if(!i.id)throw new Error("channel id is not defined");return"".concat(i.getClient().baseURL,"/channels/").concat(encodeURIComponent(i.type),"/").concat(encodeURIComponent(i.id))}));if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if("string"==typeof r&&!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=s,this._data=Zt({},s),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new Kt(this),this.initialized=!1,this.offlineMode=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}var t,n,r,s,i,a,o,c,u,l,h,d,v,y,b,w,_,x,C,O,R,U,A,P,I,L,T,D,M,j,F,N,q,B,V,H,W,z,Q,J,G,K,$,X,Y,Z,ee,te;return g(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.cid]}},{key:"sendMessage",value:(te=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",Zt({message:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return te.apply(this,arguments)})},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:(ee=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"search",value:(Z=p(k.mark((function e(t){var n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=s.length>1&&void 0!==s[1]?s[1]:{}).offset||!n.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(r=Zt(Zt({filter_conditions:{cid:this.cid}},n),{},{sort:n.sort?gt(n.sort):void 0}),"string"!=typeof t){e.next=8;break}r.query=t,e.next=13;break;case 8:if("object"!==S(t)){e.next=12;break}r.message_filter_conditions=t,e.next=13;break;case 12:throw Error("Invalid type ".concat(S(t)," for query parameter"));case 13:return e.next=15,this.getClient().wsPromise;case 15:return e.next=17,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"queryMembers",value:(Y=p(k.mark((function e(t){var n,r,s,i,a,o,c=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:[],s=c.length>2&&void 0!==c[2]?c[2]:{},a=this.type,this.id?i=this.id:null!==(n=this.data)&&void 0!==n&&n.members&&Array.isArray(this.data.members)&&(o=this.data.members),e.next=6,this.getClient().get(this.getClient().baseURL+"/members",{payload:Zt({type:a,id:i,members:o,sort:gt(r),filter_conditions:t},s)});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"partialUpdateMember",value:(X=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the user id");case 2:return e.next=4,this.getClient().patch(this._channelURL()+"/member/".concat(encodeURIComponent(t)),n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return X.apply(this,arguments)})},{key:"sendReaction",value:($=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return e.next=6,this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/reaction"),Zt({reaction:n},r));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return $.apply(this,arguments)})},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reaction/").concat(encodeURIComponent(t));return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r,{})}},{key:"update",value:(K=p(k.mark((function e(){var t,n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1?s[1]:void 0,r=s.length>2?s[2]:void 0,["config","cid","created_by","id","member_count","type","created_at","updated_at","last_message_at","own_capabilities"].forEach((function(e){delete t[e]})),e.next=7,this._update(Zt({message:n,data:t},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return K.apply(this,arguments)})},{key:"updatePartial",value:(G=p(k.mark((function e(t){var n,r,s,i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().patch(this._channelURL(),t);case 2:return s=e.sent,i=E(s.channel.own_capabilities||[]).sort().join()!==E(Array.isArray(null===(n=this.data)||void 0===n?void 0:n.own_capabilities)?null===(r=this.data)||void 0===r?void 0:r.own_capabilities:[]).sort().join(),this.data=s.channel,i&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:s.channel.own_capabilities}),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"enableSlowMode",value:(J=p(k.mark((function e(t){var n;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:t});case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"disableSlowMode",value:(Q=p(k.mark((function e(){var t;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:0});case 2:return t=e.sent,this.data=t.channel,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return Q.apply(this,arguments)})},{key:"delete",value:(z=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().delete(this._channelURL(),Zt({},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"truncate",value:(W=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this._channelURL()+"/truncate",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"acceptInvite",value:(H=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(Zt({accept_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"rejectInvite",value:(V=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(Zt({reject_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"addMembers",value:(B=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({add_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return B.apply(this,arguments)})},{key:"addModerators",value:(q=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({add_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return q.apply(this,arguments)})},{key:"assignRoles",value:(N=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({assign_roles:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"inviteMembers",value:(F=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({invites:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return F.apply(this,arguments)})},{key:"removeMembers",value:(j=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({remove_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"demoteModerators",value:(M=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(Zt({demote_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"_update",value:(D=p(k.mark((function e(t){var n;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),t);case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"mute",value:(T=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",Zt({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"unmute",value:(L=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",Zt({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"archive",value:(I=p(k.mark((function e(){var t,n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for archiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"unarchive",value:(P=p(k.mark((function e(){var t,n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for unarchiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"pin",value:(A=p(k.mark((function e(){var t,n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw new Error("A user_id is required for pinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"unpin",value:(U=p(k.mark((function e(){var t,n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw new Error("A user_id is required for unpinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:(R=p(k.mark((function e(t,n){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:if(r=new Date,s=this.lastTypingEvent&&r.getTime()-this.lastTypingEvent.getTime(),this.lastKeyStroke=r,this.isTyping=!0,!(null===s||s>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent(Zt({type:"typing.start",parent_id:t},n||{}));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"updateAIState",value:(O=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.sendEvent(Zt(Zt({},r),{},{type:"ai_indicator.update",message_id:t,ai_state:n}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"clearAIIndicator",value:(C=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendEvent({type:"ai_indicator.clear"});case 2:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"stopAIResponse",value:(x=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendEvent({type:"ai_indicator.stop"});case 2:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"stopTyping",value:(_=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent(Zt({type:"typing.stop",parent_id:t},n||{}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"_isTypingIndicatorsEnabled",value:function(){var e,t,n,r,s;return!(null===(e=this.getConfig())||void 0===e||!e.typing_events)&&(null===(t=null===(n=this.getClient().user)||void 0===n||null===(r=n.privacy_settings)||void 0===r||null===(s=r.typing_indicators)||void 0===s?void 0:s.enabled)||void 0===t||t)}},{key:"lastMessage",value:function(){var e=this.state.latestMessages.length-5;e<0&&(e=0);var t=this.state.latestMessages.length+1,n=this.state.latestMessages.slice(e,t);return n.sort((function(e,t){return t.created_at.getTime()-e.created_at.getTime()})),n[0]}},{key:"markRead",value:(w=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:{},this._checkInitialized(),null!==(t=this.getConfig())&&void 0!==t&&t.read_events||this.getClient()._isUsingServerAuth()){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",Zt({},n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"markUnread",value:(b=p(k.mark((function e(t){var n;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkInitialized(),null!==(n=this.getConfig())&&void 0!==n&&n.read_events||this.getClient()._isUsingServerAuth()){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return e.next=5,this.getClient().post(this._channelURL()+"/unread",Zt({},t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"clean",value:function(){this.lastKeyStroke&&((new Date).getTime()-this.lastKeyStroke.getTime()>1e3&&this.isTyping&&ht(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:(y=p(k.mark((function e(t){var n,r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=Zt(Zt({},n),t),e.next=7,this.query(r,"latest");case 7:return s=e.sent,this.initialized=!0,this.data=s.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"stopWatching",value:(v=p(k.mark((function e(){var t;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getReplies",value:(d=p(k.mark((function e(t,n,r){var s,i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r?gt(r):void 0,e.next=3,this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/replies"),Zt({sort:s},n));case 3:return(i=e.sent).messages&&this.state.addMessagesSorted(i.messages),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"getPinnedMessages",value:(h=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:[],e.next=3,this.getClient().get(this._channelURL()+"/pinned_messages",{payload:Zt(Zt({},t),{},{sort:gt(n)})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reactions"),Zt({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){var e=this.getClient().userID;if(e)return this.state.read[e]?this.state.read[e].last_read:null}},{key:"_countMessageAsUnread",value:function(e){var t,n,r,s;return!e.shadowed&&(!e.silent&&(!(e.parent_id&&!e.show_in_channel)&&((null===(t=e.user)||void 0===t?void 0:t.id)!==this.getClient().userID&&((null===(n=e.user)||void 0===n||!n.id||!this.getClient().userMuteStatus(e.user.id))&&(!(Array.isArray(null===(r=this.data)||void 0===r?void 0:r.own_capabilities)&&(null===(s=this.data)||void 0===s||!s.own_capabilities.includes("read-events")))&&!this.muteStatus().muted)))))}},{key:"countUnread",value:function(e){if(!e)return this.state.unreadCount;for(var t=0,n=0;n<this.state.latestMessages.length;n+=1){var r=this.state.latestMessages[n];r.created_at>e&&this._countMessageAsUnread(r)&&t++}return t}},{key:"countUnreadMentions",value:function(){for(var e=this.lastRead(),t=this.getClient().userID,n=0,r=0;r<this.state.latestMessages.length;r+=1){var s,i=this.state.latestMessages[r];this._countMessageAsUnread(i)&&(!e||i.created_at>e)&&null!==(s=i.mentioned_users)&&void 0!==s&&s.some((function(e){return e.id===t}))&&n++}return n}},{key:"query",value:(l=p(k.mark((function e(t){var n,r,s,i,a,o,c,u,l,h,d,p=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>1&&void 0!==p[1]?p[1]:"current",e.next=3,this.getClient().wsPromise;case 3:return o="".concat(this.getClient().baseURL,"/channels/").concat(encodeURIComponent(this.type)),this.id&&(o+="/".concat(encodeURIComponent(this.id))),e.next=7,this.getClient().post(o+"/query",Zt({data:this._data,state:!0},t));case 7:return c=e.sent,this.id||(this.id=c.channel.id,this.cid=c.channel.cid,(u=jt(this.type,c.members.map((function(e){var t;return e.user_id||(null===(t=e.user)||void 0===t?void 0:t.id)||""}))))&&u in this.getClient().activeChannels&&delete this.getClient().activeChannels[u],!(this.cid in this.getClient().activeChannels)&&this.getClient()._cacheEnabled()&&(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(c.channel),l=this._initializeState(c,a),(h=l.messageSet).pagination=Zt(Zt({},h.pagination),Tt({parentSet:h,messagePaginationOptions:null==t?void 0:t.messages,requestedPageSize:null!==(n=null==t||null===(r=t.messages)||void 0===r?void 0:r.limit)&&void 0!==n?n:100,returnedPage:c.messages,logger:this.getClient().logger})),this.getClient().polls.hydratePollCache(c.messages,!0),d=E(c.channel.own_capabilities||[]).sort().join()!==E(Array.isArray(null===(s=this.data)||void 0===s?void 0:s.own_capabilities)?null===(i=this.data)||void 0===i?void 0:i.own_capabilities:[]).sort().join(),this.data=c.channel,this.offlineMode=!1,d&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:c.channel.own_capabilities}),this.getClient().dispatchEvent({type:"channels.queried",queriedChannels:{channels:[c],isLatestMessageSet:h.isLatest}}),e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"banUser",value:(u=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,Zt(Zt({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"hide",value:(c=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"show",value:(o=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"unbanUser",value:(a=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"shadowBan",value:(i=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().shadowBan(t,Zt(Zt({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"removeShadowBan",value:(s=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().removeShadowBan(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createCall",value:(r=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/call",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"vote",value:(n=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().castPollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"removeVote",value:(t=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().removePollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this._client.logger("info","Attaching listener for ".concat(r," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[r].push(s),{unsubscribe:function(){n._client.logger("info","Removing listener for ".concat(r," event from channel ").concat(n.cid),{tags:["event","channel"],channel:n}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==s}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_handleChannelEvent",value:function(e){var t,n,r,s,i,a,o,c,u,l,h,d,p,f,v,g=this;this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var y=g.state;switch(e.type){case"typing.start":null!==(t=e.user)&&void 0!==t&&t.id&&(y.typing[e.user.id]=e);break;case"typing.stop":null!==(n=e.user)&&void 0!==n&&n.id&&delete y.typing[e.user.id];break;case"message.read":var b,w;if(null!==(r=e.user)&&void 0!==r&&r.id&&e.created_at)y.read[e.user.id]={last_read:new Date(e.created_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:0},(null===(b=e.user)||void 0===b?void 0:b.id)===(null===(w=this.getClient().user)||void 0===w?void 0:w.id)&&(y.unreadCount=0);break;case"user.watching.start":case"user.updated":null!==(s=e.user)&&void 0!==s&&s.id&&(y.watchers[e.user.id]=e.user);break;case"user.watching.stop":null!==(i=e.user)&&void 0!==i&&i.id&&delete y.watchers[e.user.id];break;case"message.deleted":e.message&&(this._extendEventWithOwnReactions(e),e.hard_delete?y.removeMessage(e.message):y.addMessageSorted(e.message,!1,!1),y.removeQuotedMessageReferences(e.message),e.message.pinned&&y.removePinnedMessage(e.message));break;case"message.new":if(e.message){var _,k,x,C=(null===(_=e.user)||void 0===_?void 0:_.id)===(null===(k=this.getClient().user)||void 0===k?void 0:k.id),S=e.message.parent_id&&!e.message.show_in_channel;if((this.state.isUpToDate||S)&&y.addMessageSorted(e.message,C),e.message.pinned&&y.addPinnedMessage(e.message),C||S)break;if(null!==(x=e.user)&&void 0!==x&&x.id)for(var O in y.read)O===e.user.id?y.read[e.user.id]={last_read:new Date(e.created_at),user:e.user,unread_messages:0}:y.read[O].unread_messages+=1;this._countMessageAsUnread(e.message)&&(y.unreadCount=y.unreadCount+1)}break;case"message.updated":case"message.undeleted":e.message&&(this._extendEventWithOwnReactions(e),y.addMessageSorted(e.message,!1,!1),y._updateQuotedMessageReferences({message:e.message}),e.message.pinned?y.addPinnedMessage(e.message):y.removePinnedMessage(e.message));break;case"channel.truncated":if(null!==(a=e.channel)&&void 0!==a&&a.truncated_at){var R=+new Date(e.channel.truncated_at);y.messageSets.forEach((function(e,t){e.messages.forEach((function(e){var n=e.created_at,r=e.id;R>+n&&y.removeMessage({id:r,messageSetIndex:t})}))})),y.pinnedMessages.forEach((function(e){var t=e.id,n=e.created_at;R>+n&&y.removePinnedMessage({id:t})}))}else y.clearMessages();y.unreadCount=0,e.message&&(y.addMessageSorted(e.message),e.message.pinned&&y.addPinnedMessage(e.message));break;case"member.added":case"member.updated":null!==(o=e.member)&&void 0!==o&&o.user&&(y.members=Zt(Zt({},y.members),{},m({},e.member.user.id,e.member))),"string"==typeof(null===(c=y.membership.user)||void 0===c?void 0:c.id)&&"string"==typeof(null===(u=e.member)||void 0===u||null===(l=u.user)||void 0===l?void 0:l.id)&&e.member.user.id===y.membership.user.id&&(y.membership=e.member);break;case"member.removed":if(null!==(h=e.user)&&void 0!==h&&h.id){var U=Zt({},y.members);delete U[e.user.id],y.members=U}break;case"notification.mark_unread":var E,A,P;if(!((null===(E=e.user)||void 0===E?void 0:E.id)===(null===(A=this.getClient().user)||void 0===A?void 0:A.id))||!e.user)break;var I=null!==(P=e.unread_messages)&&void 0!==P?P:0;y.read[e.user.id]={first_unread_message_id:e.first_unread_message_id,last_read:new Date(e.last_read_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:I},y.unreadCount=I;break;case"channel.updated":var L,T,D,M,j,F,N,q;if(e.channel)void 0!==(null===(L=e.channel)||void 0===L?void 0:L.frozen)&&e.channel.frozen!==(null===(T=g.data)||void 0===T?void 0:T.frozen)&&this.query({state:!1,messages:{limit:0},watchers:{limit:0}}),g.data=Zt(Zt({},e.channel),{},{hidden:null!==(D=null===(M=e.channel)||void 0===M?void 0:M.hidden)&&void 0!==D?D:null===(j=g.data)||void 0===j?void 0:j.hidden,own_capabilities:null!==(F=null===(N=e.channel)||void 0===N?void 0:N.own_capabilities)&&void 0!==F?F:null===(q=g.data)||void 0===q?void 0:q.own_capabilities});break;case"reaction.new":e.message&&e.reaction&&(e.message=y.addReaction(e.reaction,e.message));break;case"reaction.deleted":e.reaction&&(e.message=y.removeReaction(e.reaction,e.message));break;case"reaction.updated":e.reaction&&(e.message=y.addReaction(e.reaction,e.message,!0));break;case"channel.hidden":g.data=Zt(Zt({},g.data),{},{hidden:!0}),e.clear_history&&y.clearMessages();break;case"channel.visible":g.data=Zt(Zt({},g.data),{},{hidden:!1});break;case"user.banned":if(null===(d=e.user)||void 0===d||!d.id)break;y.members[e.user.id]=Zt(Zt({},y.members[e.user.id]||{}),{},{shadow_banned:!!e.shadow,banned:!e.shadow,user:Zt(Zt({},(null===(p=y.members[e.user.id])||void 0===p?void 0:p.user)||{}),e.user)});break;case"user.unbanned":if(null===(f=e.user)||void 0===f||!f.id)break;y.members[e.user.id]=Zt(Zt({},y.members[e.user.id]||{}),{},{shadow_banned:!1,banned:!1,user:Zt(Zt({},(null===(v=y.members[e.user.id])||void 0===v?void 0:v.user)||{}),e.user)})}void 0!==e.watcher_count&&(g.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.offlineMode&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",n=this.getClient(),r=n.state,s=n.user,i=n.userID;if(e.members){this._hydrateMembers({members:e.members});var a,o=$t(e.members);try{for(o.s();!(a=o.n()).done;){var c=a.value;c.user&&r.updateUserReference(c.user,this.cid)}}catch(e){o.e(e)}finally{o.f()}}this.state.membership=e.membership||{};var u=e.messages||[];this.state.messages||this.state.initMessages();var l=this.state.addMessagesSorted(u,!1,!0,!0,t),h=l.messageSet;if(this.state.pinnedMessages||(this.state.pinnedMessages=[]),this.state.addPinnedMessages(e.pinned_messages||[]),e.pending_messages&&(this.state.pending_messages=e.pending_messages),void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count),e.watchers){var d,p=$t(e.watchers);try{for(p.s();!(d=p.n()).done;){var f=d.value;f&&(r.updateUserReference(f,this.cid),this.state.watchers[f.id]=f)}}catch(e){p.e(e)}finally{p.f()}}if(null!=i){var v=this.state.last_message_at||new Date;s&&(this.state.read[s.id]={user:s,last_read:v,unread_messages:0})}if(e.read){var g,m=$t(e.read);try{for(m.s();!(g=m.n()).done;){var y,b=g.value;this.state.read[b.user.id]={last_read:new Date(b.last_read),last_read_message_id:b.last_read_message_id,unread_messages:null!==(y=b.unread_messages)&&void 0!==y?y:0,user:b.user},b.user.id===(null==s?void 0:s.id)&&(this.state.unreadCount=this.state.read[b.user.id].unread_messages)}}catch(e){m.e(e)}finally{m.f()}}return{messageSet:h}}},{key:"_extendEventWithOwnReactions",value:function(e){if(e.message){var t=this.state.findMessage(e.message.id,e.message.parent_id);t&&(e.message.own_reactions=t.own_reactions)}}},{key:"_hydrateMembers",value:function(e){var t=e.members,n=e.overrideCurrentState,r=void 0===n||n,s=t.reduce((function(e,t){return t.user&&(e[t.user.id]=t),e}),{});r?this.state.members=s:!r&&t.length&&(this.state.members=Zt(Zt({},this.state.members),s))}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0,this.state.setIsUpToDate(!1)}}]),e}();function tn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rn=function(){function e(t){var n=t.client;f(this,e),m(this,"client",void 0),m(this,"users",void 0),m(this,"userChannelReferences",void 0),this.client=n,this.users={},this.userChannelReferences={}}return g(e,[{key:"updateUsers",value:function(e){var t,n=tn(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&this.client._cacheEnabled()&&(this.users[e.id]=e)}},{key:"updateUserReference",value:function(e,t){null!=e&&this.client._cacheEnabled()&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}},{key:"deleteAllChannelReference",value:function(e){for(var t in this.userChannelReferences)delete this.userChannelReferences[t][e]}}]),e}(),sn=null;"undefined"!=typeof WebSocket?sn=WebSocket:"undefined"!=typeof MozWebSocket?sn=MozWebSocket:void 0!==y?sn=y.WebSocket||y.MozWebSocket:"undefined"!=typeof window?sn=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(sn=self.WebSocket||self.MozWebSocket);var an=sn;function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var un=function e(){f(this,e),m(this,"connectionStartTimestamp",void 0),m(this,"wsConsecutiveFailures",void 0),m(this,"wsTotalFailures",void 0),m(this,"instanceClientId",void 0),this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=yt()},ln=function(){var e=p(k.mark((function e(t,n){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=3,s=0;case 2:if(!(s<r)){e.next=17;break}return e.prev=3,e.next=6,st.post("https://chat-insights.getstream.io/insights/".concat(t),n);case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,dt(3e3*(s+1));case 12:return e.abrupt("continue",14);case 13:return e.abrupt("break",17);case 14:s++,e.next=2;break;case 17:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t,n){return e.apply(this,arguments)}}();function hn(e,t){return cn(cn({},t),dn(e))}function dn(e){var t,n,r,s=e.client;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:s.key,start_ts:s.insightMetrics.connectionStartTimestamp,end_ts:(new Date).getTime(),auth_type:s.getAuthType(),token:s.tokenManager.token,user_id:s.userID,user_details:s._user,device:s.options.device,client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:s.insightMetrics.wsConsecutiveFailures,ws_total_failures:s.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.onLine:null,user_agent:"undefined"!=typeof navigator?null===(r=navigator)||void 0===r?void 0:r.userAgent:null,instance_client_id:s.insightMetrics.instanceClientId}}function pn(e){return dn(e)}function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fn(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gn=function(e){return void 0!==e.code},mn=function(e){return void 0!==e.error},yn=function(){function e(t){var n=this,r=t.client;f(this,e),m(this,"client",void 0),m(this,"connectionID",void 0),m(this,"connectionOpen",void 0),m(this,"consecutiveFailures",void 0),m(this,"pingInterval",void 0),m(this,"healthCheckTimeoutRef",void 0),m(this,"isConnecting",void 0),m(this,"isDisconnected",void 0),m(this,"isHealthy",void 0),m(this,"isResolved",void 0),m(this,"lastEvent",void 0),m(this,"connectionCheckTimeout",void 0),m(this,"connectionCheckTimeoutRef",void 0),m(this,"rejectPromise",void 0),m(this,"requestID",void 0),m(this,"resolvePromise",void 0),m(this,"totalFailures",void 0),m(this,"ws",void 0),m(this,"wsID",void 0),m(this,"_buildUrl",(function(){var e=encodeURIComponent(n.client._buildWSPayload(n.requestID)),t=n.client.tokenManager.getToken();return"".concat(n.client.wsBaseURL,"/connect?json=").concat(e,"&api_key=").concat(n.client.key,"&authorization=").concat(t,"&stream-auth-type=").concat(n.client.getAuthType(),"&X-Stream-Client=").concat(n.client.getUserAgent())})),m(this,"onlineStatusChanged",(function(e){"offline"===e.type?(n._log("onlineStatusChanged() - Status changing to offline"),n._setHealth(!1)):"online"===e.type&&(n._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy)),n.isHealthy||n._reconnect({interval:10}))})),m(this,"onopen",(function(e){n.wsID===e&&n._log("onopen() - onopen callback",{wsID:e})})),m(this,"onmessage",(function(e,t){if(n.wsID===e){n._log("onmessage() - onmessage callback",{event:t,wsID:e});var r="string"==typeof t.data?JSON.parse(t.data):null;if(!n.isResolved&&r){var s,i;if(n.isResolved=!0,r.error)return void(null===(i=n.rejectPromise)||void 0===i||i.call(n,n._errorFromWSEvent(r,!1)));null===(s=n.resolvePromise)||void 0===s||s.call(n,r),n._setHealth(!0)}n.lastEvent=new Date,r&&"health.check"===r.type&&n.scheduleNextPing(),n.client.handleEvent(t),n.scheduleConnectionCheck()}})),m(this,"onclose",(function(e,t){if(n.wsID===e)if(n._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===ft.WS_CLOSED_SUCCESS){var r,s=new Error("WS connection reject with error ".concat(t.reason));s.reason=t.reason,s.code=t.code,s.wasClean=t.wasClean,s.target=t.target,null===(r=n.rejectPromise)||void 0===r||r.call(n,s),n._log("onclose() - WS connection reject with error ".concat(t.reason),{event:t})}else{var i;n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(i=n.rejectPromise)||void 0===i||i.call(n,n._errorFromWSEvent(t)),n._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),n._reconnect()}})),m(this,"onerror",(function(e,t){var r;n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(r=n.rejectPromise)||void 0===r||r.call(n,n._errorFromWSEvent(t)),n._log("onerror() - WS connection resulted into error",{event:t}),n._reconnect())})),m(this,"_setHealth",(function(e){e!==n.isHealthy&&(n.isHealthy=e,n.isHealthy?n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy}):setTimeout((function(){n.isHealthy||n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy})}),5e3))})),m(this,"_errorFromWSEvent",(function(e){var t,r,s,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];gn(e)&&(t=e.code,r="unknown",s=e.reason),mn(e)&&(t=e.error.code,r=e.error.StatusCode,s=e.error.message),n._log("_errorFromWSEvent() - WS failed with code ".concat(t),{event:e},"warn");var a=new Error("WS failed with code ".concat(t," and reason - ").concat(s));return a.code=t,a.StatusCode=r,a.isWSFailure=i,a})),m(this,"_setupConnectionPromise",(function(){n.isResolved=!1,n.connectionOpen=new Promise((function(e,t){n.resolvePromise=e,n.rejectPromise=t}))})),m(this,"scheduleNextPing",(function(){n.healthCheckTimeoutRef&&clearTimeout(n.healthCheckTimeoutRef),n.healthCheckTimeoutRef=setTimeout((function(){var e=[{type:"health.check",client_id:n.client.clientID}];try{var t;null===(t=n.ws)||void 0===t||t.send(JSON.stringify(e))}catch(e){}}),n.pingInterval)})),m(this,"scheduleConnectionCheck",(function(){n.connectionCheckTimeoutRef&&clearTimeout(n.connectionCheckTimeoutRef),n.connectionCheckTimeoutRef=setTimeout((function(){var e=new Date;n.lastEvent&&e.getTime()-n.lastEvent.getTime()>n.connectionCheckTimeout&&(n._log("scheduleConnectionCheck - going to reconnect"),n._setHealth(!1),n._reconnect())}),n.connectionCheckTimeout)})),this.client=r,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,Ct(this.onlineStatusChanged)}var t,n,r,s;return g(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"connection:"+e,vn({tags:["connection"]},t))}},{key:"setClient",value:function(e){this.client=e}},{key:"connect",value:(s=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:15e3,!this.isConnecting){e.next=3;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 3:return this.isDisconnected=!1,e.prev=4,e.next=7,this._connect();case 7:n=e.sent,this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(n)),e.next=23;break;case 12:if(e.prev=12,e.t0=e.catch(4),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==ft.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){e.next=21;break}this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}),e.next=23;break;case 21:if(e.t0.isWSFailure){e.next=23;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 23:return e.next=25,this._waitForHealthy(t);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(){return s.apply(this,arguments)})},{key:"_waitForHealthy",value:(r=p(k.mark((function e(){var t,n=this,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:15e3,e.abrupt("return",Promise.race([p(k.mark((function e(){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=0;case 2:if(!(s<=t)){e.next=18;break}return e.prev=3,e.next=6,n.connectionOpen;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),s!==t){e.next=13;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 13:return e.next=15,dt(r);case 15:s+=r,e.next=2;break;case 18:case"end":return e.stop()}}),e,null,[[3,9]])})))(),p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt(t);case 2:throw n.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}));case 4:case"end":return e.stop()}}),e)})))()]));case 2:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"disconnect",value:function(e){var t,n=this;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),St(this.onlineStatusChanged),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise((function(t){var s=function(e){n._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};r.onclose=s,setTimeout(s,null!=e?e:1e3)})),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),r.close(ft.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:(n=p(k.mark((function e(){var t,n,r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)){e.next=2;break}return e.abrupt("return");case 2:return this.isConnecting=!0,this.requestID=yt(),this.client.insightMetrics.connectionStartTimestamp=(new Date).getTime(),t=!1,e.prev=6,this._log("_connect() - waiting for token"),e.next=10,this.client.tokenManager.tokenReady();case 10:t=!0,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(6);case 15:if(e.prev=15,t){e.next=20;break}return this._log("_connect() - tokenProvider failed before, so going to retry"),e.next=20,this.client.tokenManager.loadToken();case 20:return this._setupConnectionPromise(),n=this._buildUrl(),this._log("_connect() - Connecting to ".concat(n),{wsURL:n,requestID:this.requestID}),this.ws=new an(n),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=30,this.connectionOpen;case 30:if(r=e.sent,this.isConnecting=!1,!r){e.next=36;break}return this.connectionID=r.connection_id,this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(ln("ws_success_after_failure",pn(this)),this.client.insightMetrics.wsConsecutiveFailures=0),e.abrupt("return",r);case 36:e.next=44;break;case 38:throw e.prev=38,e.t1=e.catch(15),this.isConnecting=!1,this._log("_connect() - Error - ",e.t1),this.client.options.enableInsights&&(this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++,s=hn(this,xt(e.t1)),null==ln||ln("ws_fatal",s)),e.t1;case 44:case"end":return e.stop()}}),e,this,[[6,13],[15,38]])}))),function(){return n.apply(this,arguments)})},{key:"_reconnect",value:(t=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this._log("_reconnect() - Initiating the reconnect"),!this.isConnecting&&!this.isHealthy){e.next=5;break}return this._log("_reconnect() - Abort (1) since already connecting or healthy"),e.abrupt("return");case 5:return(n=t.interval)||(n=mt(this.consecutiveFailures)),e.next=9,dt(n);case 9:if(!this.isConnecting&&!this.isHealthy){e.next=12;break}return this._log("_reconnect() - Abort (2) since already connecting or healthy"),e.abrupt("return");case 12:if(!this.isDisconnected||!this.client.options.enableWSFallback){e.next=15;break}return this._log("_reconnect() - Abort (3) since disconnect() is called"),e.abrupt("return");case 15:if(this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=20;break}return e.next=20,this.client.tokenManager.loadToken();case 20:return e.prev=20,e.next=23,this._connect();case 23:return this._log("_reconnect() - Waiting for recoverCallBack"),e.next=26,this.client.recoverState();case 26:this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0,e.next=38;break;case 30:if(e.prev=30,e.t0=e.catch(20),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==ft.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){e.next=37;break}return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),e.abrupt("return",this._reconnect({refreshToken:!0}));case 37:e.t0.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect());case 38:this._log("_reconnect() - == END ==");case 39:case"end":return e.stop()}}),e,this,[[20,30]])}))),function(){return t.apply(this,arguments)})},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{var e,t;null==this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),null==this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}}]),e}();function bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t)throw new TypeError("userId should be a string");wn({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function kn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={server:!0},r=C({algorithm:"HS256",noTimestamp:!0},t);return null.sign(n,e,r)}function xn(e){var t=e.split(".");if(3!==t.length)return"";var n=t[1],r=h(n);return JSON.parse(r).user_id}function Cn(e){return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",l(JSON.stringify({user_id:e})),"devtoken"].join(".")}function Sn(e,t,n){var r=Buffer.from(t,"utf8"),s=null.createHmac("sha256",r).update(e).digest("hex");try{return null.timingSafeEqual(Buffer.from(s),Buffer.from(n))}catch(e){return!1}}var On,Rn=function e(t){var n=this;f(this,e),m(this,"loadTokenPromise",void 0),m(this,"type",void 0),m(this,"secret",void 0),m(this,"token",void 0),m(this,"tokenProvider",void 0),m(this,"user",void 0),m(this,"setTokenOrProvider",function(){var e=p(k.mark((function e(t,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.validateToken(t,r),n.user=r,pt(t)&&(n.tokenProvider=t,n.type="provider"),"string"==typeof t&&(n.token=t,n.type="static"),!t&&n.user&&n.secret&&(n.token=_n(n.secret,r.id,{},{}),n.type="static"),e.next=7,n.loadToken();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"reset",(function(){n.token=void 0,n.tokenProvider=void 0,n.type="static",n.user=void 0,n.loadTokenPromise=null})),m(this,"validateToken",(function(e,t){if(!t||!t.anon||e){if(!n.secret&&!e)throw new Error("User token can not be empty");if(e&&"string"!=typeof e&&!pt(e))throw new Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var r=xn(e);if(null!=e&&(null==r||""===r||r!==t.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}})),m(this,"tokenReady",(function(){return n.loadTokenPromise})),m(this,"loadToken",(function(){return n.loadTokenPromise=new Promise(function(){var e=p(k.mark((function e(t,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==n.type){e.next=2;break}return e.abrupt("return",t(n.token));case 2:if(!n.tokenProvider||"string"==typeof n.tokenProvider){e.next=13;break}return e.prev=3,e.next=6,n.tokenProvider();case 6:n.token=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",r(new Error("Call to tokenProvider failed with message: ".concat(e.t0))));case 12:t(n.token);case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}()),n.loadTokenPromise})),m(this,"getToken",(function(){if(n.token)return n.token;if(n.user&&n.user.anon&&!n.token)return n.token;if(n.secret)return kn(n.secret);throw new Error("Both secret and user tokens are not set. Either client.connectUser wasn't called or client.disconnect was called")})),m(this,"isStatic",(function(){return"static"===n.type})),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=kn(this.secret))},Un={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function En(e){return void 0!==e.code}function An(e){if(!e.code)return!1;var t=Un["".concat(e.code)];return!!t&&t.retryable}function Pn(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Closed="CLOSED",e.Connected="CONNECTED",e.Connecting="CONNECTING",e.Disconnected="DISCONNECTED",e.Init="INIT"}(On||(On={}));var Tn=function(){function e(t){var n=this,r=t.client;f(this,e),m(this,"client",void 0),m(this,"state",void 0),m(this,"consecutiveFailures",void 0),m(this,"connectionID",void 0),m(this,"cancelToken",void 0),m(this,"_onlineStatusChanged",(function(e){var t;if(n._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type)return n._setState(On.Closed),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),void(n.cancelToken=void 0);"online"===e.type&&n.state===On.Closed&&n.connect(!0)})),m(this,"_req",function(){var e=p(k.mark((function e(t,r,s){var i,a;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.cancelToken||t.close||(n.cancelToken=st.CancelToken.source()),e.prev=1,e.next=4,n.client.doAxiosRequest("get",n.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:Ln(Ln({},r),{},{cancelToken:null===(i=n.cancelToken)||void 0===i?void 0:i.token}),params:t});case 4:return a=e.sent,n.consecutiveFailures=0,e.abrupt("return",a);case 9:if(e.prev=9,e.t0=e.catch(1),n.consecutiveFailures+=1,!s||!An(e.t0)){e.next=17;break}return n._log("_req() - Retryable error, retrying request"),e.next=16,dt(mt(n.consecutiveFailures));case 16:return e.abrupt("return",n._req(t,r,s));case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n,r){return e.apply(this,arguments)}}()),m(this,"_poll",p(k.mark((function e(){var t,r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state!==On.Connected){e.next=25;break}return e.prev=1,e.next=4,n._req({},{timeout:3e4},!0);case 4:if(r=e.sent,null!==(t=r.events)&&void 0!==t&&t.length)for(s=0;s<r.events.length;s++)n.client.dispatchEvent(r.events[s]);e.next=23;break;case 8:if(e.prev=8,e.t0=e.catch(1),!st.isCancel(e.t0)){e.next=13;break}return n._log("_poll() - axios canceled request"),e.abrupt("return");case 13:if(46!==e.t0.code){e.next=18;break}return n._log("_poll() - ConnectionID error, connecting without ID..."),n._setState(On.Disconnected),n.connect(!0),e.abrupt("return");case 18:if(!En(e.t0)||An(e.t0)){e.next=21;break}return n._setState(On.Closed),e.abrupt("return");case 21:return e.next=23,dt(mt(n.consecutiveFailures));case 23:e.next=0;break;case 25:case"end":return e.stop()}}),e,null,[[1,8]])})))),m(this,"connect",p(k.mark((function e(){var t,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],n.state!==On.Connecting){e.next=4;break}return n._log("connect() - connecting already in progress",{reconnect:t},"warn"),e.abrupt("return");case 4:if(n.state!==On.Connected){e.next=7;break}return n._log("connect() - already connected and polling",{reconnect:t},"warn"),e.abrupt("return");case 7:return n._setState(On.Connecting),n.connectionID=void 0,e.prev=9,e.next=12,n._req({json:n.client._buildWSPayload()},{timeout:8e3},t);case 12:return r=e.sent,s=r.event,n._setState(On.Connected),n.connectionID=s.connection_id,n.client.dispatchEvent(s),n._poll(),t&&n.client.recoverState(),e.abrupt("return",s);case 22:throw e.prev=22,e.t0=e.catch(9),n._setState(On.Closed),e.t0;case 26:case"end":return e.stop()}}),e,null,[[9,22]])})))),m(this,"isHealthy",(function(){return!!n.connectionID&&n.state===On.Connected})),m(this,"disconnect",p(k.mark((function e(){var t,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:2e3,St(n._onlineStatusChanged),n._setState(On.Disconnected),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),n.cancelToken=void 0,s=n.connectionID,n.connectionID=void 0,e.prev=7,e.next=10,n._req({close:!0,connection_id:s},{timeout:r},!1);case 10:n._log("disconnect() - Closed connectionID"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),n._log("disconnect() - Failed",{err:e.t0},"error");case 16:case"end":return e.stop()}}),e,null,[[7,13]])})))),this.client=r,this.state=On.Init,this.consecutiveFailures=0,Ct(this._onlineStatusChanged)}return g(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"WSConnectionFallback:"+e,Ln({tags:["connection_fallback","connection"]},t))}},{key:"_setState",value:function(e){this._log("_setState() - ".concat(e)),this.state===On.Connecting&&e===On.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),e!==On.Closed&&e!==On.Disconnected||this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}}]),e}(),Dn=function(){function e(t,n,r,s){f(this,e),m(this,"type",void 0),m(this,"id",void 0),m(this,"client",void 0),m(this,"data",void 0),this.client=t,this.type=n,this.id=r,this.data=s}var t,n,r,s,i,a,o,c;return g(e,[{key:"create",value:(c=p(k.mark((function e(){var t,n,r,s,i,a;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:null===(t=this.data)||void 0===t?void 0:t.name,filter:null===(n=this.data)||void 0===n?void 0:n.filter,description:null===(r=this.data)||void 0===r?void 0:r.description,all_sender_channels:null===(s=this.data)||void 0===s?void 0:s.all_sender_channels,all_users:null===(i=this.data)||void 0===i?void 0:i.all_users},e.abrupt("return",this.client.createSegment(this.type,this.id,a));case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"verifySegmentId",value:function(){if(!this.id)throw new Error("Segment id is missing. Either create the segment using segment.create() or set the id during instantiation - const segment = client.segment(id)")}},{key:"get",value:(o=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.getSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"update",value:(a=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.updateSegment(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"addTargets",value:(i=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.addSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"removeTargets",value:(s=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.removeSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"delete",value:(r=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.deleteSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"targetExists",value:(n=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.segmentTargetExists(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryTargets",value:(t=p(k.mark((function e(){var t,n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},this.verifySegmentId(),e.abrupt("return",this.client.querySegmentTargets(this.id,t,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function Mn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jn(e,t){return jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},jn(e,t)}function Fn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jn(e,t)}function Nn(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Mn(e)}function qn(e){return qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},qn(e)}function Bn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Vn(e,t,n){return Vn=Bn()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var s=new(Function.bind.apply(e,r));return n&&jn(s,n.prototype),s},Vn.apply(null,arguments)}function Hn(e){var t="function"==typeof Map?new Map:void 0;return Hn=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Vn(e,arguments,qn(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),jn(n,e)},Hn(e)}function Wn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qn(e);if(t){var s=qn(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return Nn(this,n)}}var zn,Qn=function(e){Fn(n,e);var t=Wn(n);function n(){var e;f(this,n);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return m(Mn(e=t.call.apply(t,[this].concat(s))),"code",void 0),m(Mn(e),"response",void 0),m(Mn(e),"status",void 0),e}return n}(Hn(Error));function Jn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.VotingVisibility=void 0,(zn=e.VotingVisibility||(e.VotingVisibility={})).anonymous="anonymous",zn.public="public";var Kn=function(e){return"function"==typeof e},$n=function e(t){var n=this;f(this,e),this.value=t,m(this,"handlerSet",new Set),m(this,"next",(function(e){var t=Kn(e)?e(n.value):e;if(t!==n.value){var r=n.value;n.value=t,n.handlerSet.forEach((function(e){return e(n.value,r)}))}})),m(this,"partialNext",(function(e){return n.next((function(t){return Gn(Gn({},t),e)}))})),m(this,"getLatestValue",(function(){return n.value})),m(this,"subscribe",(function(e){return e(n.value,void 0),n.handlerSet.add(e),function(){n.handlerSet.delete(e)}})),m(this,"subscribeWithSelector",(function(t,r){var s;return n.subscribe((function(n){var i=t(n),a=!s;for(var o in Array.isArray(i)&&e.logCount>0&&(console.warn("[StreamChat]: The API of our StateStore has changed. Instead of returning an array in the selector, please return a named object of properties."),e.logCount--),s)if(s[o]!==i[o]){a=!0;break}if(a){var c=s;s=i,r(i,c)}}))}))};m($n,"logCount",5);var Xn=["limit","sort"];function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var er=50,tr=[{created_at:-1}],nr={channel:!0,channel_cid:!0,created_at:!0,created_by_user_id:!0,parent_message_id:!0,title:!0,updated_at:!0,latest_replies:!0,active_participant_count:!0,deleted_at:!0,last_message_at:!0,participant_count:!0,reply_count:!0,read:!0,thread_participants:!0,created_by:!0,parent_message:!0},rr=function(e){var t={};for(var n in e)if(!nr[n]){var r=n;t[r]=e[r]}return t},sr=function(){function e(t){var n,r,s=this,i=t.client,a=t.threadData;f(this,e),m(this,"state",void 0),m(this,"id",void 0),m(this,"client",void 0),m(this,"unsubscribeFunctions",new Set),m(this,"failedRepliesMap",new Map),m(this,"activate",(function(){s.state.partialNext({active:!0})})),m(this,"deactivate",(function(){s.state.partialNext({active:!1})})),m(this,"reload",p(k.mark((function e(){var t;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.state.getLatestValue().isLoading){e.next=2;break}return e.abrupt("return");case 2:return s.state.partialNext({isLoading:!0}),e.prev=3,e.next=6,s.client.getThread(s.id,{watch:!0});case 6:t=e.sent,s.hydrateState(t);case 8:return e.prev=8,s.state.partialNext({isLoading:!1}),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})))),m(this,"hydrateState",(function(e){if(e!==s){if(e.id!==s.id)throw new Error("Cannot hydrate thread state with using thread's state");var t=e.state.getLatestValue(),n=t.read,r=t.replyCount,i=t.replies,a=t.parentMessage,o=t.participants,c=t.createdAt,u=t.deletedAt,l=t.updatedAt,h=Array.from(s.failedRepliesMap.values());s.state.partialNext({read:n,replyCount:r,replies:h.length?i.concat(h):i,parentMessage:a,participants:o,createdAt:c,deletedAt:u,updatedAt:l,isStateStale:!1})}})),m(this,"registerSubscriptions",(function(){s.unsubscribeFunctions.size||(s.unsubscribeFunctions.add(s.subscribeThreadUpdated()),s.unsubscribeFunctions.add(s.subscribeMarkActiveThreadRead()),s.unsubscribeFunctions.add(s.subscribeReloadActiveStaleThread()),s.unsubscribeFunctions.add(s.subscribeMarkThreadStale()),s.unsubscribeFunctions.add(s.subscribeNewReplies()),s.unsubscribeFunctions.add(s.subscribeRepliesRead()),s.unsubscribeFunctions.add(s.subscribeMessageDeleted()),s.unsubscribeFunctions.add(s.subscribeMessageUpdated()))})),m(this,"subscribeThreadUpdated",(function(){return s.client.on("thread.updated",(function(e){if(e.thread&&e.thread.parent_message_id===s.id){var t=e.thread;s.state.partialNext({title:t.title,updatedAt:new Date(t.updated_at),deletedAt:t.deleted_at?new Date(t.deleted_at):null,custom:rr(t)})}})).unsubscribe})),m(this,"subscribeMarkActiveThreadRead",(function(){return s.state.subscribeWithSelector((function(e){return{active:e.active,unreadMessageCount:or(s.client.userID)(e)}}),(function(e){var t=e.active,n=e.unreadMessageCount;t&&n&&s.throttledMarkAsRead()}))})),m(this,"subscribeReloadActiveStaleThread",(function(){return s.state.subscribeWithSelector((function(e){return{active:e.active,isStateStale:e.isStateStale}}),(function(e){var t=e.active,n=e.isStateStale;t&&n&&s.reload()}))})),m(this,"subscribeMarkThreadStale",(function(){return s.client.on("user.watching.stop",(function(e){var t,n,r=s.state.getLatestValue().channel;s.client.userID&&s.client.userID===(null===(t=e.user)||void 0===t?void 0:t.id)&&(null===(n=e.channel)||void 0===n?void 0:n.cid)===r.cid&&s.state.partialNext({isStateStale:!0})})).unsubscribe})),m(this,"subscribeNewReplies",(function(){return s.client.on("message.new",(function(e){var t,n;if(s.client.userID&&(null===(t=e.message)||void 0===t?void 0:t.parent_id)===s.id){var r=(null===(n=e.message.user)||void 0===n?void 0:n.id)===s.client.userID,i=s.state.getLatestValue(),a=i.active,o=i.read;s.upsertReplyLocally({message:e.message,timestampChanged:r}),a&&s.throttledMarkAsRead();for(var c={},u=0,l=Object.keys(o);u<l.length;u++){var h=l[u],d=o[h];if(d){var p,f=d;h===(null===(p=e.user)||void 0===p?void 0:p.id)?f=Zn(Zn({},f),{},{lastReadAt:e.created_at?new Date(e.created_at):new Date,user:e.user,unreadMessageCount:0}):a&&h===s.client.userID||(f=Zn(Zn({},f),{},{unreadMessageCount:d.unreadMessageCount+1})),c[h]=f}}s.state.partialNext({read:c})}})).unsubscribe})),m(this,"subscribeRepliesRead",(function(){return s.client.on("message.read",(function(e){if(e.user&&e.created_at&&e.thread&&e.thread.parent_message_id===s.id){var t=e.user.id,n=e.created_at,r=e.user;s.state.next((function(s){return Zn(Zn({},s),{},{read:Zn(Zn({},s.read),{},m({},t,{lastReadAt:new Date(n),user:r,lastReadMessageId:e.last_read_message_id,unreadMessageCount:0}))})}))}})).unsubscribe})),m(this,"subscribeMessageDeleted",(function(){return s.client.on("message.deleted",(function(e){e.message&&(e.message.parent_id===s.id&&(e.hard_delete?s.deleteReplyLocally({message:e.message}):s.upsertReplyLocally({message:e.message})),e.message.id===s.id&&s.updateParentMessageLocally({message:e.message}))})).unsubscribe})),m(this,"subscribeMessageUpdated",(function(){var e=["message.updated","reaction.new","reaction.deleted","reaction.updated"].map((function(e){return s.client.on(e,(function(e){e.message&&s.updateParentMessageOrReplyLocally(e.message)})).unsubscribe}));return function(){return e.forEach((function(e){return e()}))}})),m(this,"unregisterSubscriptions",(function(){s.unsubscribeFunctions.forEach((function(e){return e()})),s.unsubscribeFunctions.clear()})),m(this,"deleteReplyLocally",(function(e){var t,n=e.message,r=s.state.getLatestValue().replies,i=Ut({needle:Rt(n),sortedArray:r,sortDirection:"ascending",selectValueToCompare:function(e){return e.created_at.getTime()},selectKey:function(e){return e.id}});if((null===(t=r[i])||void 0===t?void 0:t.id)===n.id){var a=E(r);a.splice(i,1),s.state.partialNext({replies:a})}})),m(this,"upsertReplyLocally",(function(e){var t=e.message,n=e.timestampChanged,r=void 0!==n&&n;if(t.parent_id!==s.id)throw new Error("Reply does not belong to this thread");var i=Rt(t);"failed"===t.status?s.failedRepliesMap.set(i.id,i):s.failedRepliesMap.has(t.id)&&s.failedRepliesMap.delete(t.id),s.state.next((function(e){return Zn(Zn({},e),{},{replies:Et(e.replies,i,r)})}))})),m(this,"updateParentMessageLocally",(function(e){var t=e.message;if(t.id!==s.id)throw new Error("Message does not belong to this thread");s.state.next((function(e){var n,r=Rt(t);return Zn(Zn({},e),{},{deletedAt:r.deleted_at,parentMessage:r,replyCount:null!==(n=t.reply_count)&&void 0!==n?n:e.replyCount})}))})),m(this,"updateParentMessageOrReplyLocally",(function(e){e.parent_id===s.id&&s.upsertReplyLocally({message:e}),e.parent_id||e.id!==s.id||s.updateParentMessageLocally({message:e})})),m(this,"markAsRead",p(k.mark((function e(){var t,n,r,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=t.force,r=void 0!==n&&n,0!==s.ownUnreadCount||r){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,s.channel.markRead({thread_id:s.id});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))),m(this,"throttledMarkAsRead",Pt((function(){return s.markAsRead()}),1e3,{trailing:!0})),m(this,"queryReplies",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?er:t,r=e.sort,i=void 0===r?tr:r,a=O(e,Xn);return s.channel.getReplies(s.id,Zn({limit:n},a),i)})),m(this,"loadNextPage",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?er:t;return s.loadPage(n)})),m(this,"loadPrevPage",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?er:t;return s.loadPage(-n)})),m(this,"loadPage",function(){var e=p(k.mark((function e(t){var n,r,i,a,o,c,u,l,h,d,p,f,v;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.state.getLatestValue(),r=n.pagination,i=it(t>0?["isLoadingNext","nextCursor","push"]:["isLoadingPrev","prevCursor","unshift"],3),a=i[0],o=i[1],c=i[2],!r[a]&&null!==r[o]){e.next=4;break}return e.abrupt("return");case 4:return u=m({},t>0?"id_gt":"id_lt",r[o]),l=Math.abs(t),s.state.partialNext({pagination:Zn(Zn({},r),{},m({},a,!0))}),e.prev=7,e.next=10,s.queryReplies(Zn(Zn({},u),{},{limit:l}));case 10:p=e.sent,f=p.messages.map(Rt),v=null!==(h=null===(d=f.at(t>0?-1:0))||void 0===d?void 0:d.id)&&void 0!==h?h:null,s.state.next((function(e){var t,n,r=e.replies;f.length>0&&(n=r=E(e.replies))[c].apply(n,E(f));return Zn(Zn({},e),{},{replies:r,pagination:Zn(Zn({},e.pagination),{},(t={},m(t,o,p.messages.length<l?null:v),m(t,a,!1),t))})})),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),s.client.logger("error",e.t0.message),s.state.next((function(e){return Zn(Zn({},e),{},{pagination:Zn(Zn({},e.pagination),{},m({},a,!1))})}));case 20:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t){return e.apply(this,arguments)}}());var o=i.channel(a.channel.type,a.channel.id,{name:a.channel.name});o._hydrateMembers({members:null!==(n=a.channel.members)&&void 0!==n?n:[],overrideCurrentState:!1});var c=i.userID?[{user:{id:i.userID},unread_messages:0,last_read:(new Date).toISOString()}]:[];this.state=new $n({active:!1,isLoading:!1,isStateStale:!1,channel:o,createdAt:new Date(a.created_at),deletedAt:a.deleted_at?new Date(a.deleted_at):null,pagination:ar(a),parentMessage:Rt(a.parent_message),participants:a.thread_participants,read:ir(a.read&&0!==a.read.length?a.read:c),replies:a.latest_replies.map(Rt),replyCount:null!==(r=a.reply_count)&&void 0!==r?r:0,updatedAt:a.updated_at?new Date(a.updated_at):null,title:a.title,custom:rr(a)}),this.id=a.parent_message_id,this.client=i}return g(e,[{key:"channel",get:function(){return this.state.getLatestValue().channel}},{key:"hasStaleState",get:function(){return this.state.getLatestValue().isStateStale}},{key:"ownUnreadCount",get:function(){return or(this.client.userID)(this.state.getLatestValue())}}]),e}(),ir=function(e){return e.reduce((function(e,t){var n;return e[t.user.id]={user:t.user,lastReadMessageId:t.last_read_message_id,unreadMessageCount:null!==(n=t.unread_messages)&&void 0!==n?n:0,lastReadAt:new Date(t.last_read)},e}),{})},ar=function(e){var t,n;return{nextCursor:null,prevCursor:e.latest_replies.length===e.reply_count?null:null!==(t=null===(n=e.latest_replies.at(0))||void 0===n?void 0:n.id)&&void 0!==t?t:null,isLoadingNext:!1,isLoadingPrev:!1}},or=function(e){return function(t){var n;return e&&(null===(n=t.read[e])||void 0===n?void 0:n.unreadMessageCount)||0}};function cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cr(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lr={user:"stream:user",message:"stream:chat:v1:message"},hr=function(){function e(t){f(this,e),m(this,"client",void 0),this.client=t}var t,n,r,s,i,a,o,c,u,l,h,d,v,y,b;return g(e,[{key:"flagUser",value:(b=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(lr.user,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"flagMessage",value:(y=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(lr.message,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"flag",value:(v=p(k.mark((function e(t,n,r,s){var i,a=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>4&&void 0!==a[4]?a[4]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/flag",ur({entity_type:t,entity_id:n,entity_creator_id:r,reason:s},i));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return v.apply(this,arguments)})},{key:"muteUser",value:(d=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/mute",ur({target_ids:[t]},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"unmuteUser",value:(h=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/unmute",ur({target_ids:[t]},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"getUserModerationReport",value:(l=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.get(this.client.baseURL+"/api/v2/moderation/user_report",ur({user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"queryReviewQueue",value:(u=p(k.mark((function e(){var t,n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.client.post(this.client.baseURL+"/api/v2/moderation/review_queue",ur({filter:t,sort:gt(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"upsertConfig",value:(c=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/config",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getConfig",value:(o=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(this.client.baseURL+"/api/v2/moderation/config/"+t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"deleteConfig",value:(a=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.delete(this.client.baseURL+"/api/v2/moderation/config/"+t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"queryConfigs",value:(i=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/configs",ur({filter:t,sort:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"submitAction",value:(s=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/submit_action",ur({action_type:t,item_id:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"check",value:(r=p(k.mark((function e(t,n,r,s,i,a){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/check",{entity_type:t,entity_id:n,entity_creator_id:r,moderation_payload:s,config_key:i,options:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,s,i,a){return r.apply(this,arguments)})},{key:"addCustomFlags",value:(n=p(k.mark((function e(t,n,r,s,i){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/custom_check",{entity_type:t,entity_id:n,entity_creator_id:r,moderation_payload:s,flags:i});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r,s,i){return n.apply(this,arguments)})},{key:"addCustomMessageFlags",value:(t=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addCustomFlags(lr.message,t,"",{},n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function dr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gr={active:!1,isThreadOrderStale:!1,threads:[],unreadThreadCount:0,unseenThreadIds:[],lastConnectionDropAt:null,pagination:{isLoading:!1,isLoadingNext:!1,nextCursor:null},ready:!1},mr=function(){function e(t){var n=this,r=t.client;f(this,e),m(this,"state",void 0),m(this,"client",void 0),m(this,"unsubscribeFunctions",new Set),m(this,"threadsByIdGetterCache",void 0),m(this,"resetState",(function(){n.state.next(gr)})),m(this,"activate",(function(){n.state.partialNext({active:!0})})),m(this,"deactivate",(function(){n.state.partialNext({active:!1})})),m(this,"registerSubscriptions",(function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeUnreadThreadsCountChange()),n.unsubscribeFunctions.add(n.subscribeManageThreadSubscriptions()),n.unsubscribeFunctions.add(n.subscribeReloadOnActivation()),n.unsubscribeFunctions.add(n.subscribeNewReplies()),n.unsubscribeFunctions.add(n.subscribeRecoverAfterConnectionDrop()),n.unsubscribeFunctions.add(n.subscribeChannelDeleted()))})),m(this,"subscribeUnreadThreadsCountChange",(function(){var e,t=(null!==(e=n.client.user)&&void 0!==e?e:{}).unread_threads,r=void 0===t?0:t;n.state.partialNext({unreadThreadCount:r});var s=["health.check","notification.mark_read","notification.thread_message_new","notification.channel_deleted"].map((function(e){return n.client.on(e,(function(e){var t,r=(null!==(t=e.me)&&void 0!==t?t:e).unread_threads;"number"==typeof r&&n.state.partialNext({unreadThreadCount:r})})).unsubscribe}));return function(){return s.forEach((function(e){return e()}))}})),m(this,"subscribeChannelDeleted",(function(){return n.client.on("notification.channel_deleted",(function(e){var t=e.cid,r=n.state.getLatestValue().threads.filter((function(e){return e.channel.cid!==t}));n.state.partialNext({threads:r})})).unsubscribe})),m(this,"subscribeManageThreadSubscriptions",(function(){return n.state.subscribeWithSelector((function(e){return{threads:e.threads}}),(function(e,t){var r=e.threads,s=(null!=t?t:{}).threads,i=(void 0===s?[]:s).filter((function(e){return e!==n.threadsById[e.id]}));r.forEach((function(e){return e.registerSubscriptions()})),i.forEach((function(e){return e.unregisterSubscriptions()}))}))})),m(this,"subscribeReloadOnActivation",(function(){return n.state.subscribeWithSelector((function(e){return{active:e.active}}),(function(e){e.active&&n.reload()}))})),m(this,"subscribeNewReplies",(function(){return n.client.on("notification.thread_message_new",(function(e){var t,r=null===(t=e.message)||void 0===t?void 0:t.parent_id;if(r){var s=n.state.getLatestValue(),i=s.unseenThreadIds;s.ready&&(n.threadsById[r]?n.state.partialNext({isThreadOrderStale:!0}):i.includes(r)||n.state.partialNext({unseenThreadIds:i.concat(r)}))}})).unsubscribe})),m(this,"subscribeRecoverAfterConnectionDrop",(function(){var e=n.client.on("connection.changed",(function(e){!1===e.online&&n.state.next((function(e){return e.lastConnectionDropAt?e:vr(vr({},e),{},{lastConnectionDropAt:new Date})}))})).unsubscribe,t=Pt((function(){n.state.getLatestValue().lastConnectionDropAt&&n.reload({force:!0})}),1e3,{trailing:!0}),r=n.client.on("connection.recovered",t).unsubscribe;return function(){e(),r()}})),m(this,"unregisterSubscriptions",(function(){n.state.getLatestValue().threads.forEach((function(e){return e.unregisterSubscriptions()})),n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),m(this,"reload",p(k.mark((function e(){var t,r,s,i,a,o,c,u,l,h,d,p,f,v,g,m,y,b=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b.length>0&&void 0!==b[0]?b[0]:{},r=t.force,s=void 0!==r&&r,i=n.state.getLatestValue(),a=i.threads,o=i.unseenThreadIds,c=i.isThreadOrderStale,u=i.pagination,l=i.ready,!u.isLoading){e.next=4;break}return e.abrupt("return");case 4:if(s||!l||o.length||c){e.next=6;break}return e.abrupt("return");case 6:return h=a.length+o.length,e.prev=7,n.state.next((function(e){return vr(vr({},e),{},{pagination:vr(vr({},e.pagination),{},{isLoading:!0})})})),e.next=11,n.queryThreads({limit:Math.min(h,25)||25});case 11:d=e.sent,p=n.threadsById,f=[],v=dr(d.threads);try{for(v.s();!(g=v.n()).done;)m=g.value,(y=p[m.id])?(f.push(y),y.hasStaleState&&y.hydrateState(m)):f.push(m)}catch(e){v.e(e)}finally{v.f()}n.state.next((function(e){var t;return vr(vr({},e),{},{threads:f,unseenThreadIds:[],isThreadOrderStale:!1,pagination:vr(vr({},e.pagination),{},{isLoading:!1,nextCursor:null!==(t=d.next)&&void 0!==t?t:null}),ready:!0})})),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),n.client.logger("error",e.t0.message),n.state.next((function(e){return vr(vr({},e),{},{pagination:vr(vr({},e.pagination),{},{isLoading:!1})})}));case 23:case"end":return e.stop()}}),e,null,[[7,19]])})))),m(this,"queryThreads",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.client.queryThreads(vr({limit:25,participant_limit:10,reply_limit:10,watch:!0},e))})),m(this,"loadNextPage",p(k.mark((function e(){var t,r,s,i,a=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},r=n.state.getLatestValue(),!(s=r.pagination).isLoadingNext&&s.nextCursor){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,n.state.partialNext({pagination:vr(vr({},s),{},{isLoadingNext:!0})}),e.next=8,n.queryThreads(vr(vr({},t),{},{next:s.nextCursor}));case 8:i=e.sent,n.state.next((function(e){var t;return vr(vr({},e),{},{threads:i.threads.length?e.threads.concat(i.threads):e.threads,pagination:vr(vr({},e.pagination),{},{nextCursor:null!==(t=i.next)&&void 0!==t?t:null,isLoadingNext:!1})})})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),n.client.logger("error",e.t0.message),n.state.next((function(e){return vr(vr({},e),{},{pagination:vr(vr({},e.pagination),{},{isLoadingNext:!1})})}));case 16:case"end":return e.stop()}}),e,null,[[4,12]])})))),this.client=r,this.state=new $n(gr),this.threadsByIdGetterCache={threads:[],threadsById:{}}}return g(e,[{key:"threadsById",get:function(){var e=this.state.getLatestValue().threads;if(e===this.threadsByIdGetterCache.threads)return this.threadsByIdGetterCache.threadsById;var t=e.reduce((function(e,t){return e[t.id]=t,e}),{});return this.threadsByIdGetterCache.threads=e,this.threadsByIdGetterCache.threadsById=t,t}}]),e}(),yr=["own_votes","id"],br=["id"];function wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wr(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kr=function(e){return!(null==e||!e.answer_text)},xr=function(){function e(t){var n=this,r=t.client,s=t.poll;f(this,e),m(this,"state",void 0),m(this,"id",void 0),m(this,"client",void 0),m(this,"unsubscribeFunctions",new Set),m(this,"getInitialStateFromPollResponse",(function(e){var t,n=e.own_votes;e.id;var r=O(e,yr),s=null!==(t=null==n?void 0:n.reduce((function(e,t){return kr(t)?e.ownAnswer=t:e.ownVotes.push(t),e}),{ownVotes:[]}))&&void 0!==t?t:{ownVotes:[]},i=s.ownAnswer,a=s.ownVotes;return _r(_r({},r),{},{lastActivityAt:new Date,maxVotedOptionIds:Cr(r.vote_counts_by_option),ownAnswer:i,ownVotesByOptionId:Sr(a)})})),m(this,"reinitializeState",(function(e){n.state.partialNext(n.getInitialStateFromPollResponse(e))})),m(this,"handlePollUpdated",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.updated"===e.type){var r=O(Or(e.poll),br);n.state.partialNext(_r(_r({},r),{},{lastActivityAt:new Date(e.created_at)}))}})),m(this,"handlePollClosed",(function(e){var t;null!==(t=e.poll)&&void 0!==t&&t.id&&e.poll.id!==n.id||"poll.closed"===e.type&&n.state.partialNext({is_closed:!0,lastActivityAt:new Date(e.created_at)})})),m(this,"handleVoteCasted",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_casted"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=E(r.latest_answers),a=r.ownAnswer,o=r.ownVotesByOptionId,c=r.maxVotedOptionIds;s&&(kr(e.poll_vote)?a=e.poll_vote:e.poll_vote.option_id&&(o[e.poll_vote.option_id]=e.poll_vote)),kr(e.poll_vote)?i=[e.poll_vote].concat(E(i)):c=Cr(e.poll.vote_counts_by_option);var u=Rr(e.poll);n.state.partialNext(_r(_r({},u),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}})),m(this,"handleVoteChanged",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_changed"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=E(r.latest_answers),a=r.ownAnswer,o=r.ownVotesByOptionId,c=r.maxVotedOptionIds;if(s){if(kr(e.poll_vote))i=[e.poll_vote].concat(E(i.filter((function(t){return t.id!==e.poll_vote.id})))),a=e.poll_vote;else if(e.poll_vote.option_id){var u;e.poll.enforce_unique_votes?o=m({},e.poll_vote.option_id,e.poll_vote):(o=Object.entries(o).reduce((function(t,n){var r=it(n,2),s=r[0],i=r[1];return s!==e.poll_vote.option_id&&i.id===e.poll_vote.id||(t[s]=i),t}),{}))[e.poll_vote.option_id]=e.poll_vote,(null===(u=a)||void 0===u?void 0:u.id)===e.poll_vote.id&&(a=void 0),c=Cr(e.poll.vote_counts_by_option)}}else kr(e.poll_vote)?i=[e.poll_vote].concat(E(i)):c=Cr(e.poll.vote_counts_by_option);var l=Rr(e.poll);n.state.partialNext(_r(_r({},l),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}})),m(this,"handleVoteRemoved",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_removed"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=E(r.latest_answers),a=r.ownAnswer,o=_r({},r.ownVotesByOptionId),c=r.maxVotedOptionIds;kr(e.poll_vote)?(i=i.filter((function(t){return t.id!==e.poll_vote.id})),s&&(a=void 0)):(c=Cr(e.poll.vote_counts_by_option),s&&e.poll_vote.option_id&&delete o[e.poll_vote.option_id]);var u=Rr(e.poll);n.state.partialNext(_r(_r({},u),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}})),m(this,"query",function(){var e=p(k.mark((function e(t){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.getPoll(t);case 2:return r=e.sent,s=r.poll,n.state.partialNext(_r(_r({},s),{},{lastActivityAt:new Date})),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"update",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.updatePoll(_r(_r({},t),{},{id:n.id}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"partialUpdate",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.partialUpdatePoll(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"close",p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.closePoll(n.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),m(this,"delete",p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.deletePoll(n.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),m(this,"createOption",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.createPollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"updateOption",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.updatePollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"deleteOption",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.deletePollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"castVote",function(){var e=p(k.mark((function e(t,r){var s,i,a,o,c;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.data,i=s.max_votes_allowed,a=s.ownVotesByOptionId,!(i&&i===Object.keys(a).length)){e.next=8;break}if(c=Object.values(a)[0],Object.values(a).slice(1).forEach((function(e){var t;(null===(t=c)||void 0===t||!t.created_at||new Date(e.created_at)<new Date(c.created_at))&&(c=e)})),null===(o=c)||void 0===o||!o.id){e.next=8;break}return e.next=8,n.removeVote(c.id,r);case 8:return e.next=10,n.client.castPollVote(r,n.id,{option_id:t});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"removeVote",function(){var e=p(k.mark((function e(t,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.removePollVote(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"addAnswer",function(){var e=p(k.mark((function e(t,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.addPollAnswer(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"removeAnswer",function(){var e=p(k.mark((function e(t,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.removePollVote(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"queryAnswers",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.queryPollAnswers(n.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"queryOptionVotes",function(){var e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.queryPollVotes(n.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.client=r,this.id=s.id,this.state=new $n(this.getInitialStateFromPollResponse(s))}return g(e,[{key:"data",get:function(){return this.state.getLatestValue()}}]),e}();function Cr(e){for(var t=0,n=[],r=0,s=Object.entries(null!=e?e:{});r<s.length;r++){var i=it(s[r],2),a=i[0],o=i[1];o>t?(n=[a],t=o):o===t&&n.push(a)}return n}function Sr(e){return e?e.reduce((function(e,t){return kr(t)||!t.option_id||(e[t.option_id]=t),e}),{}):{}}function Or(e){return{allow_answers:e.allow_answers,allow_user_suggested_options:e.allow_user_suggested_options,description:e.description,enforce_unique_vote:e.enforce_unique_vote,id:e.id,is_closed:e.is_closed,max_votes_allowed:e.max_votes_allowed,name:e.name,options:e.options,voting_visibility:e.voting_visibility}}function Rr(e){return{answers_count:e.answers_count,latest_votes_by_option:e.latest_votes_by_option,vote_count:e.vote_count,vote_counts_by_option:e.vote_counts_by_option}}function Ur(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Er(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function Er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ar=function(){function e(t){var n=this,r=t.client;f(this,e),m(this,"client",void 0),m(this,"pollCache",new Map),m(this,"unsubscribeFunctions",new Set),m(this,"fromState",(function(e){return n.pollCache.get(e)})),m(this,"registerSubscriptions",(function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeMessageNew()),n.unsubscribeFunctions.add(n.subscribePollUpdated()),n.unsubscribeFunctions.add(n.subscribePollClosed()),n.unsubscribeFunctions.add(n.subscribeVoteCasted()),n.unsubscribeFunctions.add(n.subscribeVoteChanged()),n.unsubscribeFunctions.add(n.subscribeVoteRemoved()))})),m(this,"unregisterSubscriptions",(function(){n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),m(this,"createPoll",function(){var e=p(k.mark((function e(t){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.createPoll(t);case 2:return r=e.sent,s=r.poll,e.abrupt("return",new xr({client:n.client,poll:s}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"getPoll",function(){var e=p(k.mark((function e(t){var r,s,i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=n.fromState(t))){e.next=4;break}return n.client.getPoll(t).then((function(e){var t=e.poll;return n.setOrOverwriteInCache(t,!0)})),e.abrupt("return",r);case 4:return e.next=6,n.client.getPoll(t);case 6:return s=e.sent,i=s.poll,n.setOrOverwriteInCache(i),e.abrupt("return",n.fromState(t));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"queryPolls",function(){var e=p(k.mark((function e(t){var r,s,i,a,o,c,u=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:[],s=u.length>2&&void 0!==u[2]?u[2]:{},e.next=4,n.client.queryPolls(t,r,s);case 4:return i=e.sent,a=i.polls,o=i.next,c=a.map((function(e){return n.setOrOverwriteInCache(e,!0),n.fromState(e.id)})),e.abrupt("return",{polls:c,next:o});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"hydratePollCache",(function(e,t){var r,s=Ur(e);try{for(s.s();!(r=s.n()).done;){var i=r.value;if(i.poll){var a=i.poll;n.setOrOverwriteInCache(a,t)}}}catch(e){s.e(e)}finally{s.f()}})),m(this,"setOrOverwriteInCache",(function(e,t){if(n.client._cacheEnabled()){var r=n.fromState(e.id);if(r)t&&r.reinitializeState(e);else{var s=new xr({client:n.client,poll:e});n.pollCache.set(s.id,s)}}})),m(this,"subscribePollUpdated",(function(){return n.client.on("poll.updated",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handlePollUpdated(e))})).unsubscribe})),m(this,"subscribePollClosed",(function(){return n.client.on("poll.closed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handlePollClosed(e))})).unsubscribe})),m(this,"subscribeVoteCasted",(function(){return n.client.on("poll.vote_casted",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteCasted(e))})).unsubscribe})),m(this,"subscribeVoteChanged",(function(){return n.client.on("poll.vote_changed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteChanged(e))})).unsubscribe})),m(this,"subscribeVoteRemoved",(function(){return n.client.on("poll.vote_removed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteRemoved(e))})).unsubscribe})),m(this,"subscribeMessageNew",(function(){return n.client.on("message.new",(function(e){var t=e.message;if(t){var r=Rt(t);n.hydratePollCache([r])}})).unsubscribe})),this.client=r}return g(e,[{key:"data",get:function(){return this.pollCache}}]),e}();function Pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Lr={"channel.deleted":"channelDeletedHandler","channel.hidden":"channelHiddenHandler","channel.truncated":"channelTruncatedHandler","channel.visible":"channelVisibleHandler","message.new":"newMessageHandler","member.updated":"memberUpdatedHandler","notification.added_to_channel":"notificationAddedToChannelHandler","notification.message_new":"notificationNewMessageHandler","notification.removed_from_channel":"notificationRemovedFromChannelHandler"},Tr={abortInFlightQuery:!1,allowNotLoadedChannelPromotionForEvent:{"channel.visible":!0,"message.new":!0,"notification.added_to_channel":!0,"notification.message_new":!0},lockChannelOrder:!1},Dr={limit:10,offset:0},Mr=function e(t){var n=this,r=t.client,s=t.eventHandlerOverrides,i=void 0===s?{}:s,a=t.options,o=void 0===a?{}:a;f(this,e),m(this,"state",void 0),m(this,"client",void 0),m(this,"unsubscribeFunctions",new Set),m(this,"eventHandlers",new Map),m(this,"eventHandlerOverrides",new Map),m(this,"options",{}),m(this,"stateOptions",{}),m(this,"setChannels",(function(e){n.state.next((function(t){var n=t.channels,r=Kn(e)?e(n):e;return n===r?t:Ir(Ir({},t),{},{channels:r})}))})),m(this,"setEventHandlerOverrides",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.entries(e).reduce((function(e,t){var n=it(t,2),r=n[0],s=n[1];return s&&(e[r]=s),e}),{});n.eventHandlerOverrides=new Map(Object.entries(t))})),m(this,"setOptions",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.options=Ir(Ir({},Tr),e)})),m(this,"queryChannels",function(){var e=p(k.mark((function e(t){var r,s,i,a,o,c,u,l,h,d,p,f,v,g,m=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:[],s=m.length>2&&void 0!==m[2]?m[2]:{},i=m.length>3&&void 0!==m[3]?m[3]:{},a=Ir(Ir({},Dr),s),o=a.offset,c=a.limit,u=n.state.getLatestValue(),!u.pagination.isLoading||n.options.abortInFlightQuery){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,n.stateOptions=i,n.state.next((function(e){return Ir(Ir({},e),{},{pagination:Ir(Ir({},e.pagination),{},{isLoading:!0,isLoadingNext:!1,filters:t,sort:r,options:s})})})),e.next=12,n.client.queryChannels(t,r,s,i);case 12:d=e.sent,p=o+(null!==(l=null==d?void 0:d.length)&&void 0!==l?l:0),f=Ir(Ir({},s),{},{offset:p}),v=n.state.getLatestValue(),g=v.pagination,n.state.partialNext({channels:d,pagination:Ir(Ir({},g),{},{hasNext:(null!==(h=null==d?void 0:d.length)&&void 0!==h?h:0)>=c,isLoading:!1,options:f}),initialized:!0}),e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(7),n.client.logger("error",e.t0.message),n.state.next((function(e){return Ir(Ir({},e),{},{pagination:Ir(Ir({},e.pagination),{},{isLoading:!1})})})),e.t0;case 24:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(t){return e.apply(this,arguments)}}()),m(this,"loadNext",p(k.mark((function e(){var t,r,s,i,a,o,c,u,l,h,d,p,f,v,g,m,y,b;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state.getLatestValue(),r=t.pagination,s=t.initialized,i=r.filters,a=r.sort,o=r.options,c=r.isLoadingNext,u=r.hasNext,s&&!c&&u){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,d=Ir(Ir({},Dr),o),p=d.offset,f=d.limit,n.state.partialNext({pagination:Ir(Ir({},r),{},{isLoading:!1,isLoadingNext:!0})}),e.next=9,n.client.queryChannels(i,a,o,n.stateOptions);case 9:v=e.sent,g=n.state.getLatestValue(),m=g.channels,y=p+(null!==(l=null==v?void 0:v.length)&&void 0!==l?l:0),b=Ir(Ir({},o),{},{offset:y}),n.state.partialNext({channels:It([].concat(E(m||[]),E(v)),"cid"),pagination:Ir(Ir({},r),{},{hasNext:(null!==(h=null==v?void 0:v.length)&&void 0!==h?h:0)>=f,isLoading:!1,isLoadingNext:!1,options:b})}),e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(4),n.client.logger("error",e.t0.message),n.state.next((function(e){return Ir(Ir({},e),{},{pagination:Ir(Ir({},e.pagination),{},{isLoadingNext:!1})})})),e.t0;case 21:case"end":return e.stop()}}),e,null,[[4,16]])})))),m(this,"notificationAddedToChannelHandler",function(){var e=p(k.mark((function e(t){var r,s,i,a,o,c,u,l,h,d,p;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!==(r=null==t?void 0:t.channel)&&void 0!==r?r:{},a=i.id,o=i.type,c=i.members,o&&null!==(s=n.options.allowNotLoadedChannelPromotionForEvent)&&void 0!==s&&s["notification.added_to_channel"]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Mt({client:n.client,id:a,members:null==c?void 0:c.reduce((function(e,t){var n=t.user,r=t.user_id||(null==n?void 0:n.id);return r&&e.push(r),e}),[]),type:o});case 5:if(u=e.sent,l=n.state.getLatestValue(),h=l.pagination,d=l.channels){e.next=9;break}return e.abrupt("return");case 9:p=(null!=h?h:{}).sort,n.setChannels(zt({channels:d,channelToMove:u,sort:p}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"channelDeletedHandler",(function(e){var t=n.state.getLatestValue().channels;if(t){var r=E(t),s=r.findIndex((function(t){var n;return t.cid===(e.cid||(null===(n=e.channel)||void 0===n?void 0:n.cid))}));s<0||(r.splice(s,1),n.setChannels(r))}})),m(this,"channelHiddenHandler",this.channelDeletedHandler),m(this,"newMessageHandler",(function(e){var t,r=n.state.getLatestValue(),s=r.pagination,i=r.channels;if(i){var a=null!=s?s:{},o=a.filters,c=a.sort,u=e.channel_type,l=e.channel_id;if(u&&l){var h=n.client.channel(u,l),d=i.indexOf(h),p=d>=0,f=Ft(h),v=Nt(h),g=qt(o),m=Vt(c);g&&v&&!o.archived||g&&!v&&o.archived||m&&f||n.options.lockChannelOrder||!(p||null!==(t=n.options.allowNotLoadedChannelPromotionForEvent)&&void 0!==t&&t["message.new"])||n.setChannels(zt({channels:i,channelToMove:h,channelToMoveIndexWithinChannels:d,sort:c}))}}})),m(this,"notificationNewMessageHandler",function(){var e=p(k.mark((function e(t){var r,s,i,a,o,c,u,l,h,d,p,f,v,g;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!==(r=null==t?void 0:t.channel)&&void 0!==r?r:{},a=i.id,o=i.type,a&&o){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Mt({client:n.client,id:a,type:o});case 5:if(c=e.sent,u=n.state.getLatestValue(),l=u.channels,h=u.pagination,p=(d=null!=h?h:{}).filters,f=d.sort,v=qt(p),g=Nt(c),!(!l||v&&g&&!p.archived||v&&!g&&p.archived||null===(s=n.options.allowNotLoadedChannelPromotionForEvent)||void 0===s)&&s["notification.message_new"]){e.next=12;break}return e.abrupt("return");case 12:n.setChannels(zt({channels:l,channelToMove:c,sort:f}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"channelVisibleHandler",function(){var e=p(k.mark((function e(t){var r,s,i,a,o,c,u,l,h,d,p,f;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.channel_type,i=t.channel_id,s&&i){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Mt({client:n.client,id:t.channel_id,type:t.channel_type});case 5:if(a=e.sent,o=n.state.getLatestValue(),c=o.channels,u=o.pagination,h=(l=null!=u?u:{}).sort,d=l.filters,p=qt(d),f=Nt(a),!(!c||p&&f&&!d.archived||p&&!f&&d.archived||null===(r=n.options.allowNotLoadedChannelPromotionForEvent)||void 0===r)&&r["channel.visible"]){e.next=12;break}return e.abrupt("return");case 12:n.setChannels(zt({channels:c,channelToMove:a,sort:h}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"notificationRemovedFromChannelHandler",this.channelDeletedHandler),m(this,"memberUpdatedHandler",(function(e){var t,r=n.state.getLatestValue(),s=r.pagination,i=r.channels,a=s.filters,o=s.sort;if(null!==(t=e.member)&&void 0!==t&&t.user&&e.member.user.id===n.client.userID&&e.channel_type&&e.channel_id){var c=e.channel_type,u=e.channel_id,l=Vt(o),h=qt(a),d=Bt({atIndex:0,sort:o,targetKey:"pinned_at"});if(i&&(l||h)&&!n.options.lockChannelOrder){var p=n.client.channel(c,u),f=i.indexOf(p),v=f>=0,g=Ft(p),m=Nt(p),y=E(i);if(v&&y.splice(f,1),h&&!m&&null!=a&&a.archived||h&&m&&(null==a||!a.archived))n.setChannels(y);else{var b=null;(1===d||-1===d&&!g)&&(b=Wt({channels:y}));var w="number"==typeof b?b+1:0;i[w]!==p&&(y.splice(w,0,p),n.setChannels(y))}}}})),m(this,"subscriptionOrOverride",(function(e){var t=Lr[e.type],r=n.eventHandlers.get(t),s=n.eventHandlerOverrides.get(t);s&&"function"==typeof s?s(n.setChannels,e):r&&"function"==typeof r&&r(e)})),m(this,"registerSubscriptions",(function(){if(!n.unsubscribeFunctions.size)for(var e=0,t=Object.keys(Lr);e<t.length;e++){var r=t[e];n.unsubscribeFunctions.add(n.client.on(r,n.subscriptionOrOverride).unsubscribe)}})),m(this,"unregisterSubscriptions",(function(){n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),this.client=r,this.state=new $n({channels:[],pagination:{isLoading:!1,isLoadingNext:!1,hasNext:!1,filters:{},sort:{},options:Dr},initialized:!1}),this.setEventHandlerOverrides(i),this.setOptions(o),this.eventHandlers=new Map(Object.entries({channelDeletedHandler:this.channelDeletedHandler,channelHiddenHandler:this.channelHiddenHandler,channelVisibleHandler:this.channelVisibleHandler,memberUpdatedHandler:this.memberUpdatedHandler,newMessageHandler:this.newMessageHandler,notificationAddedToChannelHandler:this.notificationAddedToChannelHandler,notificationNewMessageHandler:this.notificationNewMessageHandler,notificationRemovedFromChannelHandler:this.notificationRemovedFromChannelHandler}))},jr=["created_at","updated_at","last_active","online"],Fr=["params","headers"];function Nr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hr(e){return"string"==typeof e||e instanceof String}var Wr=function(){function e(t,n,r){var s,i=this;f(this,e),m(this,"_user",void 0),m(this,"activeChannels",void 0),m(this,"threads",void 0),m(this,"polls",void 0),m(this,"anonymous",void 0),m(this,"persistUserOnConnectionFailure",void 0),m(this,"axiosInstance",void 0),m(this,"baseURL",void 0),m(this,"browser",void 0),m(this,"cleaningIntervalRef",void 0),m(this,"clientID",void 0),m(this,"configs",void 0),m(this,"key",void 0),m(this,"listeners",void 0),m(this,"logger",void 0),m(this,"recoverStateOnReconnect",void 0),m(this,"moderation",void 0),m(this,"mutedChannels",void 0),m(this,"mutedUsers",void 0),m(this,"node",void 0),m(this,"options",void 0),m(this,"secret",void 0),m(this,"setUserPromise",void 0),m(this,"state",void 0),m(this,"tokenManager",void 0),m(this,"user",void 0),m(this,"userAgent",void 0),m(this,"userID",void 0),m(this,"wsBaseURL",void 0),m(this,"wsConnection",void 0),m(this,"wsFallback",void 0),m(this,"wsPromise",void 0),m(this,"consecutiveFailures",void 0),m(this,"insightMetrics",void 0),m(this,"defaultWSTimeoutWithFallback",void 0),m(this,"defaultWSTimeout",void 0),m(this,"nextRequestAbortController",null),m(this,"_getConnectionID",(function(){var e,t;return(null===(e=i.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=i.wsFallback)||void 0===t?void 0:t.connectionID)})),m(this,"_hasConnectionID",(function(){return Boolean(i._getConnectionID())})),m(this,"connectUser",function(){var e=p(k.mark((function e(t,n){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw new Error('The "id" field on the user is missing');case 2:if(i.userID!==t.id||!i.setUserPromise){e.next=5;break}return console.warn("Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),e.abrupt("return",i.setUserPromise);case 5:if(!i.userID){e.next=7;break}throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");case 7:return!i._isUsingServerAuth()&&!i.node||i.options.allowServerSideConnect||console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),i.userID=t.id,i.anonymous=!1,r=i._setToken(t,n),i._setUser(t),s=i.openConnection(),i.setUserPromise=Promise.all([r,s]).then((function(e){return e[1]})),e.prev=14,e.next=17,i.setUserPromise;case 17:return e.abrupt("return",e.sent);case 20:throw e.prev=20,e.t0=e.catch(14),i.persistUserOnConnectionFailure?i.closeConnection():i.disconnectUser(),e.t0;case 24:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,n){return e.apply(this,arguments)}}()),m(this,"setUser",this.connectUser),m(this,"_setToken",(function(e,t){return i.tokenManager.setTokenOrProvider(t,e)})),m(this,"closeConnection",function(){var e=p(k.mark((function e(t){var n,r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=i.cleaningIntervalRef&&(clearInterval(i.cleaningIntervalRef),i.cleaningIntervalRef=void 0),e.next=3,Promise.all([null===(n=i.wsConnection)||void 0===n?void 0:n.disconnect(t),null===(r=i.wsFallback)||void 0===r?void 0:r.disconnect(t)]);case 3:return e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"createChannelManager",(function(e){var t=e.eventHandlerOverrides,n=void 0===t?{}:t,r=e.options;return new Mr({client:i,eventHandlerOverrides:n,options:void 0===r?{}:r})})),m(this,"openConnection",p(k.mark((function e(){var t,n,r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.userID){e.next=2;break}throw Error("User is not set on client, use client.connectUser or client.connectAnonymousUser instead");case 2:if(null===(t=i.wsConnection)||void 0===t||!t.isConnecting||!i.wsPromise){e.next=5;break}return i.logger("info","client:openConnection() - connection already in progress",{tags:["connection","client"]}),e.abrupt("return",i.wsPromise);case 5:if(!(null!==(n=i.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=i.wsFallback)&&void 0!==r&&r.isHealthy())||!i._hasConnectionID()){e.next=8;break}return i.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists",{tags:["connection","client"]}),e.abrupt("return");case 8:return i.clientID="".concat(i.userID,"--").concat(yt()),i.wsPromise=i.connect(),i._startCleaning(),e.abrupt("return",i.wsPromise);case 12:case"end":return e.stop()}}),e)})))),m(this,"_setupConnection",this.openConnection),m(this,"_normalizeDate",(function(e){if(e instanceof Date&&(e=e.toISOString()),""===e)throw new Error("Don't pass blank string for since, use null instead if resetting the token revoke");return e})),m(this,"disconnectUser",function(){var e=p(k.mark((function e(t){var n,r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete i.user,delete i._user,delete i.userID,i.anonymous=!1,n=i.closeConnection(t),r=0,s=Object.values(i.activeChannels);r<s.length;r++)s[r]._disconnect();return i.activeChannels={},i.state=new rn({client:i}),i.threads.resetState(),setTimeout(i.tokenManager.reset),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"disconnect",this.disconnectUser),m(this,"connectAnonymousUser",(function(){!i._isUsingServerAuth()&&!i.node||i.options.allowServerSideConnect||console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),i.anonymous=!0,i.userID=yt();var e={id:i.userID,anon:!0};return i._setToken(e,""),i._setUser(e),i._setupConnection()})),m(this,"setAnonymousUser",this.connectAnonymousUser),m(this,"doAxiosRequest",function(){var e=p(k.mark((function e(t,n,r){var s,a,o,c,u=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=u.length>3&&void 0!==u[3]?u[3]:{},e.next=3,i.tokenManager.tokenReady();case 3:a=i._enrichAxiosOptions(s),e.prev=4,i._logApiRequest(t,n,r,a),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"postForm"===e.t0?21:"put"===e.t0?25:"patch"===e.t0?29:"options"===e.t0?33:37;break;case 9:return e.next=11,i.axiosInstance.get(n,a);case 11:case 15:case 19:case 23:case 27:case 31:case 35:return o=e.sent,e.abrupt("break",38);case 13:return e.next=15,i.axiosInstance.delete(n,a);case 17:return e.next=19,i.axiosInstance.post(n,r,a);case 21:return e.next=23,i.axiosInstance.postForm(n,r,a);case 25:return e.next=27,i.axiosInstance.put(n,r,a);case 29:return e.next=31,i.axiosInstance.patch(n,r,a);case 33:return e.next=35,i.axiosInstance.options(n,a);case 37:throw new Error("Invalid request type");case 38:return i._logApiResponse(t,n,o),i.consecutiveFailures=0,e.abrupt("return",i.handleResponse(o));case 43:if(e.prev=43,e.t1=e.catch(4),e.t1.client_request_id=null===(c=a.headers)||void 0===c?void 0:c["x-client-request-id"],i._logApiError(t,n,e.t1),i.consecutiveFailures+=1,!e.t1.response){e.next=60;break}if(e.t1.response.data.code!==ft.TOKEN_EXPIRED||i.tokenManager.isStatic()){e.next=57;break}if(!(i.consecutiveFailures>1)){e.next=53;break}return e.next=53,dt(mt(i.consecutiveFailures));case 53:return i.tokenManager.loadToken(),e.next=56,i.doAxiosRequest(t,n,r,s);case 56:return e.abrupt("return",e.sent);case 57:return e.abrupt("return",i.handleResponse(e.t1.response));case 60:throw e.t1;case 61:case"end":return e.stop()}}),e,null,[[4,43]])})));return function(t,n,r){return e.apply(this,arguments)}}()),m(this,"dispatchEvent",(function(e){e.received_at||(e.received_at=new Date);var t=i._handleClientEvent(e),n=e.cid,r=n?i.activeChannels[n]:void 0;r&&r._handleChannelEvent(e),i._callClientListeners(e),r&&r._callChannelListeners(e),t.forEach((function(e){return e()}))})),m(this,"handleEvent",(function(e){var t=e.data,n=JSON.parse(t);i.dispatchEvent(n)})),m(this,"_updateMemberWatcherReferences",(function(e){var t=i.state.userChannelReferences[e.id]||{};for(var n in t){var r=i.activeChannels[n];null!=r&&r.state&&(r.state.members[e.id]&&(r.state.members[e.id].user=e),r.state.watchers[e.id]&&(r.state.watchers[e.id]=e),r.state.read[e.id]&&(r.state.read[e.id].user=e))}})),m(this,"_updateUserReferences",this._updateMemberWatcherReferences),m(this,"_updateUserMessageReferences",(function(e){var t=i.state.userChannelReferences[e.id]||{};for(var n in t){var r=i.activeChannels[n];if(r){var s=r.state;null==s||s.updateUserMessages(e)}}})),m(this,"_deleteUserMessageReference",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=i.state.userChannelReferences[e.id]||{};for(var r in n){var s=i.activeChannels[r];if(s){var a=s.state;null==a||a.deleteUserMessages(e,t)}}})),m(this,"_handleUserEvent",(function(e){if(e.user){if("user.presence.changed"===e.type||"user.updated"===e.type){if(e.user.id===i.userID){var t=Vr({},i.user||{}),n=Vr({},i._user||{});for(var r in i.user)r in e.user||{channel_mutes:!0,devices:!0,mutes:!0,total_unread_count:!0,unread_channels:!0,unread_count:!0,unread_threads:!0,invisible:!0,privacy_settings:!0,roles:!0,push_preferences:!0}[r]||(delete t[r],delete n[r]);for(var s in e.user)n&&s in n&&(n[s]=e.user[s]);i._user=Vr({},n),i.user=Vr(Vr({},t),e.user)}i.state.updateUser(e.user),i._updateMemberWatcherReferences(e.user)}"user.updated"===e.type&&i._updateUserMessageReferences(e.user),"user.deleted"===e.type&&e.user.deleted_at&&(e.mark_messages_deleted||e.hard_delete)&&i._deleteUserMessageReference(e.user,e.hard_delete)}})),m(this,"_callClientListeners",(function(e){var t=i,n=[];t.listeners.all&&n.push.apply(n,E(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,E(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){(0,s[r])(e)}})),m(this,"recoverState",p(k.mark((function e(){var t;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(i._getConnectionID()),{tags:["connection"]}),!(t=Object.keys(i.activeChannels)).length||!i.recoverStateOnReconnect){e.next=10;break}return i.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=6,i.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30});case 6:i.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),i.dispatchEvent({type:"connection.recovered"}),e.next=11;break;case 10:i.dispatchEvent({type:"connection.recovered"});case 11:i.wsPromise=Promise.resolve(),i.setUserPromise=Promise.resolve();case 13:case"end":return e.stop()}}),e)})))),m(this,"getChannelByMembers",(function(e,t){var n,r=(null!==(n=t.members)&&void 0!==n?n:[]).map((function(e){var t;return"string"==typeof e?e:null!==(t=e.user_id)&&void 0!==t?t:""})),s=r.sort().join(","),a=jt(e,r);if(!a)throw Error("Please specify atleast one member when creating unique conversation");for(var o in i.activeChannels){var c=i.activeChannels[o];if(!c.disconnected){if(o===a)return c;if(0===o.indexOf("".concat(e,":!members-")))if(Object.keys(c.state.members).sort().join(",")===s)return c}}var u=new en(i,e,void 0,t);return i._cacheEnabled()&&(i.activeChannels[a]=u),u})),m(this,"getChannelById",(function(e,t,n){if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in i.activeChannels&&i.activeChannels[r]&&!i.activeChannels[r].disconnected){var s=i.activeChannels[r];return Object.keys(n).length>0&&(s.data=Vr(Vr({},s.data),n),s._data=Vr(Vr({},s._data),n)),s}var a=new en(i,e,t,n);return i._cacheEnabled()&&(i.activeChannels[a.cid]=a),a})),m(this,"updateUsers",this.upsertUsers),m(this,"updateUser",this.upsertUser),m(this,"_unblockMessage",this.unblockMessage),m(this,"markAllRead",this.markChannelsRead),m(this,"_isUsingServerAuth",(function(){return!!i.secret})),m(this,"_cacheEnabled",(function(){return!i._isUsingServerAuth()||!i.options.disableCache})),m(this,"_buildWSPayload",(function(e){return JSON.stringify({user_id:i.userID,user_details:i._user,device:i.options.device,client_request_id:e})})),this.key=t,this.listeners={},this.state=new rn({client:this}),this.mutedChannels=[],this.mutedUsers=[],this.moderation=new hr(this),n&&Hr(n)&&(this.secret=n);var a=r||(n&&!Hr(n)?n:{});this.browser=void 0!==a.browser?a.browser:"undefined"!=typeof window,this.node=!this.browser,this.options=Vr({timeout:3e3,withCredentials:!1,warmUp:!1,recoverStateOnReconnect:!0,disableCache:!1},a),this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new null.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.axiosInstance=st.create(this.options),this.setBaseURL(this.options.baseURL||"https://chat.stream-io-api.com"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://"+process.env.STREAM_LOCAL_TEST_HOST),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.persistUserOnConnectionFailure=null===(s=this.options)||void 0===s?void 0:s.persistUserOnConnectionFailure,this.tokenManager=new Rn(this.secret),this.consecutiveFailures=0,this.insightMetrics=new un,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.axiosInstance.defaults.paramsSerializer=Ot,this.logger=pt(a.logger)?a.logger:function(){return null},this.recoverStateOnReconnect=this.options.recoverStateOnReconnect,this.threads=new mr({client:this}),this.polls=new Ar({client:this})}var t,n,r,s,i,a,o,c,u,l,h,d,v,y,b,w,_,R,U,A,P,I,L,T,D,M,j,F,N,q,B,V,H,W,z,Q,J,G,K,$,X,Y,Z,ee,te,ne,re,se,ie,ae,oe,ce,ue,le,he,de,pe,fe,ve,ge,me,ye,be,we,_e,ke,xe,Ce,Se,Oe,Re,Ue,Ee,Ae,Pe,Ie,Le,Te,De,Me,je,Fe,Ne,qe,Be,Ve,He,We,ze,Qe,Je,Ge,Ke,$e,Xe,Ye,Ze,et,tt,nt,rt,it,at,ot,ct,ut,lt,ht,bt,wt,_t;return g(e,[{key:"devToken",value:function(e){return Cn(e)}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")}},{key:"_setUser",value:function(e){this.user=e,this.userID=e.id,this._user=Vr({},e)}},{key:"updateAppSettings",value:(_t=p(k.mark((function e(t){var n;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(n=t.apn_config)&&n.p12_cert&&(t=Vr(Vr({},t),{},{apn_config:Vr(Vr({},n),{},{p12_cert:Buffer.from(n.p12_cert).toString("base64")})})),e.next=4,this.patch(this.baseURL+"/app",t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _t.apply(this,arguments)})},{key:"revokeTokens",value:(wt=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateAppSettings({revoke_tokens_issued_before:this._normalizeDate(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return wt.apply(this,arguments)})},{key:"revokeUserToken",value:(bt=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.revokeUsersToken([t],n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return bt.apply(this,arguments)})},{key:"revokeUsersToken",value:(ht=p(k.mark((function e(t,n){var r,s,i,a;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0===n?(new Date).toISOString():this._normalizeDate(n),r=[],s=Nr(t);try{for(s.s();!(i=s.n()).done;)a=i.value,r.push({id:a,set:{revoke_tokens_issued_before:n}})}catch(e){s.e(e)}finally{s.f()}return e.next=6,this.partialUpdateUsers(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return ht.apply(this,arguments)})},{key:"getAppSettings",value:(lt=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return lt.apply(this,arguments)})},{key:"testPushSettings",value:(ut=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",Vr(Vr(Vr(Vr(Vr(Vr(Vr({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}),n.skipDevices?{skip_devices:!0}:{}),n.pushProviderName?{push_provider_name:n.pushProviderName}:{}),n.pushProviderType?{push_provider_type:n.pushProviderType}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ut.apply(this,arguments)})},{key:"testSQSSettings",value:(ct=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sqs",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return ct.apply(this,arguments)})},{key:"testSNSSettings",value:(ot=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sns",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return ot.apply(this,arguments)})},{key:"setGuestUser",value:(at=p(k.mark((function e(t){var n,r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,(r=n.user).created_at,r.updated_at,r.last_active,r.online,s=O(r,jr),e.next=15,this.connectUser(s,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return at.apply(this,arguments)})},{key:"createToken",value:function(e,t,n){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var r={};return t&&(r.exp=t),n&&(r.iat=n),_n(this.secret,e,r,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(s),{unsubscribe:function(){n.logger("info","Removing listener for ".concat(r," event"),{tags:["event","client"]}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==s}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,s){var i=vt(t,n,r||"multipart/form-data");return null!=s&&i.append("user",JSON.stringify(s)),this.doAxiosRequest("postForm",e,i,{headers:i.getHeaders?i.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new Qn("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t,n=e.data;if(!(t=e).status||t.status<200||300<=t.status)throw this.errorFromResponse(e);return n}},{key:"_handleClientEvent",value:function(e){var t,n,r,s=this,i=this,a=[];(this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),"user.presence.changed"!==e.type&&"user.updated"!==e.type&&"user.deleted"!==e.type||this._handleUserEvent(e),"health.check"===e.type&&e.me&&(i.user=e.me,i.state.updateUser(e.me),i.mutedChannels=e.me.channel_mutes,i.mutedUsers=e.me.mutes),e.channel&&"notification.message_new"===e.type&&this._addChannelConfig(e.channel),"notification.channel_mutes_updated"===e.type&&null!==(t=e.me)&&void 0!==t&&t.channel_mutes&&(this.mutedChannels=e.me.channel_mutes),"notification.mutes_updated"===e.type&&null!==(n=e.me)&&void 0!==n&&n.mutes&&(this.mutedUsers=e.me.mutes),"notification.mark_read"===e.type&&0===e.unread_channels)&&Object.keys(this.activeChannels).forEach((function(e){return s.activeChannels[e].state.unreadCount=0}));"channel.deleted"!==e.type&&"notification.channel_deleted"!==e.type||!e.cid||(i.state.deleteAllChannelReference(e.cid),null===(r=this.activeChannels[e.cid])||void 0===r||r._disconnect(),a.push((function(){e.cid&&delete s.activeChannels[e.cid]})));return a}},{key:"_muteStatus",value:function(e){for(var t,n=0;n<this.mutedChannels.length;n++){var r,s=this.mutedChannels[n];if((null===(r=s.channel)||void 0===r?void 0:r.cid)===e){t={muted:!s.expires||new Date(s.expires).getTime()>(new Date).getTime(),createdAt:s.created_at?new Date(s.created_at):new Date,expiresAt:s.expires?new Date(s.expires):null};break}}return t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"connect",value:(it=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userID&&this._user){e.next=2;break}throw Error("Call connectUser or connectAnonymousUser before starting the connection");case 2:if(this.wsBaseURL){e.next=4;break}throw Error("Websocket base url not set");case 4:if(this.clientID){e.next=6;break}throw Error("clientID is not set");case 6:if(this.wsConnection||!this.options.warmUp&&!this.options.enableInsights||this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new yn({client:this}),e.prev=8,!this.wsFallback){e.next=13;break}return e.next=12,this.wsFallback.connect();case 12:case 15:case 28:return e.abrupt("return",e.sent);case 13:return e.next=15,this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout);case 18:if(e.prev=18,e.t0=e.catch(8),!(this.options.enableWSFallback&&Pn(e.t0)&&(t=void 0,t="undefined"!=typeof navigator?navigator:"undefined"!=typeof window&&window.navigator?window.navigator:void 0,t?"boolean"!=typeof t.onLine||t.onLine:(console.warn("isOnline failed to access window.navigator and assume browser is online"),1)))){e.next=29;break}return this.logger("info","client:connect() - WS failed, fallback to longpoll",{tags:["connection","client"]}),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new Tn({client:this}),e.next=28,this.wsFallback.connect();case 29:throw e.t0;case 30:case"end":return e.stop()}var t}),e,this,[[8,18]])}))),function(){return it.apply(this,arguments)})},{key:"_sayHi",value:function(){var e=this,t=yt(),n={headers:{"x-client-request-id":t}};this.doAxiosRequest("get",this.baseURL+"/hi",null,n).catch((function(n){e.options.enableInsights&&ln("http_hi_failed",{api_key:e.key,err:n,client_request_id:t})}))}},{key:"queryUsers",value:(rt=p(k.mark((function e(t){var n,r,s,i,a=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},s={presence:!1},e.next=5,this.wsPromise;case 5:return this._hasConnectionID()||(s.presence=!1),e.next=8,this.get(this.baseURL+"/users",{payload:Vr(Vr({filter_conditions:t,sort:gt(n)},s),r)});case 8:return i=e.sent,this.state.updateUsers(i.users),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return rt.apply(this,arguments)})},{key:"queryBannedUsers",value:(nt=p(k.mark((function e(){var t,n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.get(this.baseURL+"/query_banned_users",{payload:Vr({filter_conditions:t,sort:gt(n)},r)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return nt.apply(this,arguments)})},{key:"queryMessageFlags",value:(tt=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.get(this.baseURL+"/moderation/flags/message",{payload:Vr({filter_conditions:t},n)});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return tt.apply(this,arguments)})},{key:"queryChannels",value:(et=p(k.mark((function e(t){var n,r,s,i,a,o,c=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:[],r=c.length>2&&void 0!==c[2]?c[2]:{},s=c.length>3&&void 0!==c[3]?c[3]:{},i={state:!0,watch:!0,presence:!1},e.next=6,this.wsPromise;case 6:return this._hasConnectionID()||(i.watch=!1),a=Vr(Vr({filter_conditions:t,sort:gt(n)},i),r),e.next=10,this.post(this.baseURL+"/channels",a);case 10:return o=e.sent,this.dispatchEvent({type:"channels.queried",queriedChannels:{channels:o.channels,isLatestMessageSet:!0}}),e.abrupt("return",this.hydrateActiveChannels(o.channels,s,r));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return et.apply(this,arguments)})},{key:"queryReactions",value:(Ze=p(k.mark((function e(t,n){var r,s,i,a=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:[],s=a.length>3&&void 0!==a[3]?a[3]:{},e.next=4,this.wsPromise;case 4:return i=Vr({filter:n,sort:gt(r)},s),e.next=7,this.post(this.baseURL+"/messages/"+encodeURIComponent(t)+"/reactions",i);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ze.apply(this,arguments)})},{key:"hydrateActiveChannels",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=n.skipInitialization,i=n.offlineMode,a=void 0!==i&&i,o=[],c=Nr(t);try{for(c.s();!(e=c.n()).done;){var u=e.value;this._addChannelConfig(u.channel);var l=this.channel(u.channel.type,u.channel.id);l.data=u.channel,l.offlineMode=a,l.initialized=!a,l.push_preferences=u.push_preferences;var h=void 0;if(void 0===s){var d=l._initializeState(u,"latest"),p=d.messageSet;h=p}else if(!s.includes(u.channel.id)){l.state.clearMessages();var f=l._initializeState(u,"latest"),v=f.messageSet;h=v}h&&(h.pagination=Vr(Vr({},h.pagination),Tt({parentSet:h,requestedPageSize:(null==r?void 0:r.message_limit)||25,returnedPage:u.messages,logger:this.logger})),this.polls.hydratePollCache(u.messages,!0)),o.push(l)}}catch(e){c.e(e)}finally{c.f()}return o}},{key:"search",value:(Ye=p(k.mark((function e(t,n){var r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=i.length>2&&void 0!==i[2]?i[2]:{}).offset||!r.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(s=Vr(Vr({filter_conditions:t},r),{},{sort:r.sort?gt(r.sort):void 0}),"string"!=typeof n){e.next=8;break}s.query=n,e.next=13;break;case 8:if("object"!==S(n)){e.next=12;break}s.message_filter_conditions=n,e.next=13;break;case 12:throw Error("Invalid type ".concat(S(n)," for query parameter"));case 13:return e.next=15,this.wsPromise;case 15:return e.next=17,this.get(this.baseURL+"/search",{payload:s});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ye.apply(this,arguments)})},{key:"setLocalDevice",value:function(e){var t,n,r;if(null!==(t=this.wsConnection)&&void 0!==t&&t.isConnecting&&this.wsPromise||(null!==(n=this.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=this.wsFallback)&&void 0!==r&&r.isHealthy())&&this._hasConnectionID())throw new Error("you can only set device before opening a websocket connection");this.options.device=e}},{key:"addDevice",value:(Xe=p(k.mark((function e(t,n,r,s){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/devices",Vr(Vr({id:t,push_provider:n},null!=r?{user_id:r}:{}),null!=s?{push_provider_name:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return Xe.apply(this,arguments)})},{key:"getDevices",value:($e=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return $e.apply(this,arguments)})},{key:"getUnreadCount",value:(Ke=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/unread",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ke.apply(this,arguments)})},{key:"getUnreadCountBatch",value:(Ge=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/unread_batch",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ge.apply(this,arguments)})},{key:"setPushPreferences",value:(Je=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_preferences",{preferences:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Je.apply(this,arguments)})},{key:"removeDevice",value:(Qe=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/devices",Vr({id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Qe.apply(this,arguments)})},{key:"getRateLimits",value:(ze=p(k.mark((function e(t){var n,r,s,i,a,o;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t||{}).serverSide,s=n.web,i=n.android,a=n.ios,o=n.endpoints,e.abrupt("return",this.get(this.baseURL+"/rate_limits",{server_side:r,web:s,android:i,ios:a,endpoints:o?o.join(","):void 0}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ze.apply(this,arguments)})},{key:"_addChannelConfig",value:function(e){var t=e.cid,n=e.config;this._cacheEnabled()&&(this.configs[t]=n)}},{key:"channel",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call connectUser or connectAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));return t&&"object"===S(t)?this.getChannelByMembers(e,t):!t&&"object"===S(r)&&null!==(n=r.members)&&void 0!==n&&n.length?this.getChannelByMembers(e,r):t?this.getChannelById(e,t,r):new en(this,e,void 0,r)}},{key:"partialUpdateUser",value:(We=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return We.apply(this,arguments)})},{key:"upsertUsers",value:(He=p(k.mark((function e(t){var n,r,s,i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=Nr(t),e.prev=2,r.s();case 4:if((s=r.n()).done){e.next=11;break}if((i=s.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[i.id]=i;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return He.apply(this,arguments)})},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"partialUpdateUsers",value:(Ve=p(k.mark((function e(t){var n,r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Nr(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(e){return Ve.apply(this,arguments)})},{key:"deleteUser",value:(Be=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(encodeURIComponent(t)),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Be.apply(this,arguments)})},{key:"restoreUsers",value:(qe=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/restore",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return qe.apply(this,arguments)})},{key:"reactivateUser",value:(Ne=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/reactivate"),Vr({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ne.apply(this,arguments)})},{key:"reactivateUsers",value:(Fe=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/reactivate",Vr({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Fe.apply(this,arguments)})},{key:"deactivateUser",value:(je=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/deactivate"),Vr({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return je.apply(this,arguments)})},{key:"deactivateUsers",value:(Me=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/deactivate",Vr({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Me.apply(this,arguments)})},{key:"exportUser",value:(De=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(encodeURIComponent(t),"/export"),Vr({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return De.apply(this,arguments)})},{key:"banUser",value:(Te=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",Vr({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Te.apply(this,arguments)})},{key:"unbanUser",value:(Le=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",Vr({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Le.apply(this,arguments)})},{key:"shadowBan",value:(Ie=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.banUser(t,Vr({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ie.apply(this,arguments)})},{key:"removeShadowBan",value:(Pe=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.unbanUser(t,Vr({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Pe.apply(this,arguments)})},{key:"blockUser",value:(Ae=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/block",Vr({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ae.apply(this,arguments)})},{key:"getBlockedUsers",value:(Ee=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/block",Vr({},t?{user_id:t}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ee.apply(this,arguments)})},{key:"unBlockUser",value:(Ue=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/unblock",Vr({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ue.apply(this,arguments)})},{key:"muteUser",value:(Re=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/moderation/mute",Vr(Vr({target_id:t},n?{user_id:n}:{}),r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return Re.apply(this,arguments)})},{key:"unmuteUser",value:(Oe=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unmute",Vr({target_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Oe.apply(this,arguments)})},{key:"userMuteStatus",value:function(e){if(!this.user||!this.wsPromise)throw new Error("Make sure to await connectUser() first.");for(var t=0;t<this.mutedUsers.length;t+=1)if(this.mutedUsers[t].target.id===e)return!0;return!1}},{key:"flagMessage",value:(Se=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",Vr({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Se.apply(this,arguments)})},{key:"flagUser",value:(Ce=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",Vr({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Ce.apply(this,arguments)})},{key:"unflagMessage",value:(xe=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",Vr({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return xe.apply(this,arguments)})},{key:"unflagUser",value:(ke=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",Vr({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ke.apply(this,arguments)})},{key:"getCallToken",value:(_e=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/calls/".concat(encodeURIComponent(t)),Vr({},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return _e.apply(this,arguments)})},{key:"_queryFlags",value:(we=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/flags",Vr({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return we.apply(this,arguments)})},{key:"_queryFlagReports",value:(be=p(k.mark((function e(){var t,n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/reports",Vr({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return be.apply(this,arguments)})},{key:"_reviewFlagReport",value:(ye=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.patch(this.baseURL+"/moderation/reports/".concat(encodeURIComponent(t)),Vr({review_result:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return ye.apply(this,arguments)})},{key:"unblockMessage",value:(me=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unblock_message",Vr({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return me.apply(this,arguments)})},{key:"markChannelsRead",value:(ge=p(k.mark((function e(){var t,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",Vr({},t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return ge.apply(this,arguments)})},{key:"createCommand",value:function(e){return this.post(this.baseURL+"/commands",e)}},{key:"getCommand",value:function(e){return this.get(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"updateCommand",value:function(e,t){return this.put(this.baseURL+"/commands/".concat(encodeURIComponent(e)),t)}},{key:"deleteCommand",value:function(e){return this.delete(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"listCommands",value:function(){return this.get(this.baseURL+"/commands")}},{key:"createChannelType",value:function(e){var t=C({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:(ve=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ve.apply(this,arguments)})},{key:"translate",value:(fe=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/translate",{text:t,source_language:r,destination_language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return fe.apply(this,arguments)})},{key:"_normalizeExpiration",value:function(e){var t=null;if("number"==typeof e){var n=new Date;n.setSeconds(n.getSeconds()+e),t=n.toISOString()}else Hr(e)?t=e:e instanceof Date&&(t=e.toISOString());return t}},{key:"_validateAndGetMessageId",value:function(e,t){var n;if("string"==typeof e)n=e;else{if(!e.id)throw Error(t);n=e.id}return n}},{key:"pinMessage",value:function(e,t,n,r){var s=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(s,{set:{pinned:!0,pin_expires:this._normalizeExpiration(t),pinned_at:this._normalizeExpiration(r)}},n)}},{key:"unpinMessage",value:function(e,t){var n=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(n,{set:{pinned:!1}},t)}},{key:"updateMessage",value:(pe=p(k.mark((function e(t,n,r){var s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMessage");case 2:return delete(s=C({},t)).id,["command","created_at","html","latest_reactions","own_reactions","quoted_message","reaction_counts","reply_count","type","updated_at","user","__html"].forEach((function(e){null!=s[e]&&delete s[e]})),null!=n&&(Hr(n)?s.user_id=n:s.user={id:n.id}),Array.isArray(s.mentioned_users)&&!Hr(s.mentioned_users[0])&&(s.mentioned_users=s.mentioned_users.map((function(e){return e.id}))),e.next=10,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t.id)),Vr({message:s},r));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return pe.apply(this,arguments)})},{key:"partialUpdateMessage",value:(de=p(k.mark((function e(t,n,r,s){var i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateMessage");case 2:return i=r,null!=r&&Hr(r)&&(i={id:r}),e.next=6,this.put(this.baseURL+"/messages/".concat(encodeURIComponent(t)),Vr(Vr(Vr({},n),s),{},{user:i}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return de.apply(this,arguments)})},{key:"deleteMessage",value:(he=p(k.mark((function e(t,n){var r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t)),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return he.apply(this,arguments)})},{key:"undeleteMessage",value:(le=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/undelete"),{undeleted_by:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return le.apply(this,arguments)})},{key:"getMessage",value:(ue=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(encodeURIComponent(t)),Vr({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ue.apply(this,arguments)})},{key:"queryThreads",value:(ce=p(k.mark((function e(){var t,n,r,s=this,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=Vr({limit:10,participant_limit:10,reply_limit:3,watch:!0},t),e.next=4,this.post("".concat(this.baseURL,"/threads"),n);case 4:return r=e.sent,e.abrupt("return",{threads:r.threads.map((function(e){return new sr({client:s,threadData:e})})),next:r.next});case 6:case"end":return e.stop()}}),e,this)}))),function(){return ce.apply(this,arguments)})},{key:"getThread",value:(oe=p(k.mark((function e(t){var n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},t){e.next=3;break}throw Error("Please specify the messageId when calling getThread");case 3:return r=Vr({participant_limit:100,reply_limit:3,watch:!0},n),e.next=6,this.get("".concat(this.baseURL,"/threads/").concat(encodeURIComponent(t)),r);case 6:return s=e.sent,e.abrupt("return",new sr({client:this,threadData:s.thread}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return oe.apply(this,arguments)})},{key:"partialUpdateThread",value:(ae=p(k.mark((function e(t,n){var r,s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateThread");case 2:r=["created_at","id","last_message_at","type","updated_at","user","reply_count","participants","channel","custom"],e.t0=k.keys(Vr(Vr({},n.set),n.unset));case 4:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,!r.includes(s)){e.next=8;break}throw Error("You cannot set ".concat(s," field on Thread object. ").concat(s," is reserved for server-side use. Please omit ").concat(s," from your set object."));case 8:e.next=4;break;case 10:return e.next=12,this.patch("".concat(this.baseURL,"/threads/").concat(encodeURIComponent(t)),n);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return ae.apply(this,arguments)})},{key:"getUserAgent",value:function(){return this.userAgent||"stream-chat-javascript-client-".concat(this.node?"node":"browser","-","8.56.1")}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},n=this._getToken(),r=n?{Authorization:n}:void 0,s=null;null!==this.nextRequestAbortController&&(s=this.nextRequestAbortController.signal,this.nextRequestAbortController=null),null!==(e=t.headers)&&void 0!==e&&e["x-client-request-id"]||(t.headers=Vr(Vr({},t.headers),{},{"x-client-request-id":yt()}));var i=this.options.axiosRequestConfig||{},a=i.params,o=i.headers,c=O(i,Fr);return Vr(Vr(Vr({params:Vr(Vr({user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key},t.params),a||{}),headers:Vr(Vr(Vr({},r),{},{"stream-auth-type":this.getAuthType(),"X-Stream-Client":this.getUserAgent()},t.headers),o||{})},s?{signal:s}:{}),t.config),c||{})}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval((function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}}),500))}},{key:"verifyWebhook",value:function(e,t){return!!this.secret&&Sn(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/permissions"),Vr({},e))}},{key:"updatePermission",value:function(e,t){return this.put("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)),Vr({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/permissions"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/roles"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/roles"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/roles/").concat(encodeURIComponent(e)))}},{key:"sync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.post("".concat(this.baseURL,"/sync"),Vr({channel_cids:e,last_sync_at:t},n))}},{key:"sendUserCustomEvent",value:(ie=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post("".concat(this.baseURL,"/users/").concat(encodeURIComponent(t),"/event"),{event:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:"createBlockList",value:function(e){return this.post("".concat(this.baseURL,"/blocklists"),e)}},{key:"listBlockLists",value:function(e){return this.get("".concat(this.baseURL,"/blocklists"),e)}},{key:"getBlockList",value:function(e,t){return this.get("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"updateBlockList",value:function(e,t){return this.put("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"deleteBlockList",value:function(e,t){return this.delete("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"exportChannels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Vr({channels:e},t);return this.post("".concat(this.baseURL,"/export_channels"),n)}},{key:"exportUsers",value:function(e){return this.post("".concat(this.baseURL,"/export/users"),e)}},{key:"exportChannel",value:function(e,t){return this.exportChannels([e],t)}},{key:"getExportChannelStatus",value:function(e){return this.get("".concat(this.baseURL,"/export_channels/").concat(encodeURIComponent(e)))}},{key:"campaign",value:function(e,t){return e&&"object"===S(e)?new x(this,null,e):new x(this,e,t)}},{key:"segment",value:function(e,t,n){return"string"==typeof t?new Dn(this,e,t,n):new Dn(this,e,null,t)}},{key:"validateServerSideAuth",value:function(){if(!this.secret)throw new Error("Campaigns is a server-side only feature. Please initialize the client with a secret to use this feature.")}},{key:"createSegment",value:(se=p(k.mark((function e(t,n,r){var s;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),s=Vr({id:n,type:t},r),e.abrupt("return",this.post(this.baseURL+"/segments",s));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return se.apply(this,arguments)})},{key:"createUserSegment",value:(re=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("user",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return re.apply(this,arguments)})},{key:"createChannelSegment",value:(ne=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("channel",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ne.apply(this,arguments)})},{key:"getSegment",value:(te=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return te.apply(this,arguments)})},{key:"updateSegment",value:(ee=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/segments/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ee.apply(this,arguments)})},{key:"addSegmentTargets",value:(Z=p(k.mark((function e(t,n){var r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/addtargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Z.apply(this,arguments)})},{key:"querySegmentTargets",value:(Y=p(k.mark((function e(t){var n,r,s,i=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:[],s=i.length>3&&void 0!==i[3]?i[3]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/targets/query"),Vr({filter:n||{},sort:r||[]},s)));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"removeSegmentTargets",value:(X=p(k.mark((function e(t,n){var r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/deletetargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return X.apply(this,arguments)})},{key:"querySegments",value:($=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/query",Vr({filter:t,sort:n},r)));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"deleteSegment",value:(K=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"segmentTargetExists",value:(G=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/target/").concat(encodeURIComponent(n))));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return G.apply(this,arguments)})},{key:"createCampaign",value:(J=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns",Vr({},t)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"getCampaign",value:(Q=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"startCampaign",value:(z=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/start"),{scheduled_for:null==n?void 0:n.scheduledFor,stop_at:null==n?void 0:n.stopAt}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"queryCampaigns",value:(W=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.next=3,this.post(this.baseURL+"/campaigns/query",Vr({filter:t,sort:n},r||{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return W.apply(this,arguments)})},{key:"updateCampaign",value:(H=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/campaigns/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"deleteCampaign",value:(V=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"stopCampaign",value:(B=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/stop")));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"enrichURL",value:(q=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.baseURL+"/og",{url:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getTask",value:(N=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get("".concat(this.baseURL,"/tasks/").concat(encodeURIComponent(t))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"deleteChannels",value:(F=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/channels/delete",Vr({cids:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"deleteUsers",value:(j=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=r.length>1&&void 0!==r[1]?r[1]:{}).user||["soft","hard","pruning"].includes(n.user)){e.next=3;break}throw new Error("Invalid delete user options. user must be one of [soft hard pruning]");case 3:if(void 0===n.conversations||["soft","hard"].includes(n.conversations)){e.next=5;break}throw new Error("Invalid delete user options. conversations must be one of [soft hard]");case 5:if(void 0===n.messages||["soft","hard","pruning"].includes(n.messages)){e.next=7;break}throw new Error("Invalid delete user options. messages must be one of [soft hard pruning]");case 7:return e.next=9,this.post(this.baseURL+"/users/delete",Vr({user_ids:t},n));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"_createImportURL",value:(M=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/import_urls",{filename:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"_createImport",value:(D=p(k.mark((function e(t){var n,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{mode:"upsert"},e.next=3,this.post(this.baseURL+"/imports",Vr({path:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"_getImport",value:(T=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports/".concat(encodeURIComponent(t)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"_listImports",value:(L=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"upsertPushProvider",value:(I=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_providers",{push_provider:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"deletePushProvider",value:(P=p(k.mark((function e(t){var n,r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.name,e.next=3,this.delete(this.baseURL+"/push_providers/".concat(encodeURIComponent(n),"/").concat(encodeURIComponent(r)));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"listPushProviders",value:(A=p(k.mark((function e(){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/push_providers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"createAbortControllerForNextRequest",value:function(){return this.nextRequestAbortController=new AbortController}},{key:"commitMessage",value:(U=p(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/commit"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"createPoll",value:(R=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls",Vr(Vr({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"getPoll",value:(_=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t)),n?{user_id:n}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"updatePoll",value:(w=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls",Vr(Vr({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"partialUpdatePoll",value:(b=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.patch(this.baseURL+"/polls/".concat(encodeURIComponent(t)),Vr(Vr({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"deletePoll",value:(y=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t)),Vr({},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"closePoll",value:(v=p(k.mark((function e(t,n){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.partialUpdatePoll(t,{set:{is_closed:!0}},n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"createPollOption",value:(d=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),Vr(Vr({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"getPollOption",value:(h=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"updatePollOption",value:(l=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),Vr(Vr({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"deletePollOption",value:(u=p(k.mark((function e(t,n,r){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"castPollVote",value:(c=p(k.mark((function e(t,n,r,s){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote"),Vr({vote:r},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return c.apply(this,arguments)})},{key:"addPollAnswer",value:(o=p(k.mark((function e(t,n,r,s){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.castPollVote(t,n,{answer_text:r},s));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"removePollVote",value:(a=p(k.mark((function e(t,n,r,s){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote/").concat(encodeURIComponent(r)),Vr({},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"queryPolls",value:(i=p(k.mark((function e(){var t,n,r,s,i,a=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},s=a.length>3?a[3]:void 0,i=s?"?user_id=".concat(s):"",e.next=7,this.post(this.baseURL+"/polls/query".concat(i),Vr({filter:t,sort:gt(n)},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"queryPollVotes",value:(s=p(k.mark((function e(t){var n,r,s,i,a,o=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},i=o.length>4?o[4]:void 0,a=i?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),Vr({filter:n,sort:gt(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"queryPollAnswers",value:(r=p(k.mark((function e(t){var n,r,s,i,a,o=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},i=o.length>4?o[4]:void 0,a=i?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),Vr({filter:Vr(Vr({},n),{},{is_answer:!0}),sort:gt(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"queryMessageHistory",value:(n=p(k.mark((function e(){var t,n,r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.post(this.baseURL+"/messages/history",Vr({filter:t,sort:gt(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateFlags",value:(t=p(k.mark((function e(t,n){var r,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/automod/v1/moderation/update_flags",Vr({message_ids:t,reviewed_by:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"getInstance",value:function(t,n,r){return e._instance||(e._instance="string"==typeof n?new e(t,n,r):new e(t,n)),e._instance}}]),e}();m(Wr,"_instance",void 0);var zr="Allow",Qr="Deny",Jr=["*"],Gr=["*"],Kr=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jr,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gr,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:zr;f(this,e),m(this,"name",void 0),m(this,"action",void 0),m(this,"owner",void 0),m(this,"priority",void 0),m(this,"resources",void 0),m(this,"roles",void 0),this.name=t,this.action=a,this.owner=i,this.priority=n,this.resources=r,this.roles=s},$r=new Kr("Allow all",999,Jr,Gr,!1,zr),Xr=new Kr("Deny all",1,Jr,Gr,!1,Qr),Yr=["lastQueryError"];function Zr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qn(e);if(t){var s=qn(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return Nn(this,n)}}function es(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?es(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):es(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ns={debounceMs:300,pageSize:10},rs=function(){function e(t){var n=this;f(this,e),m(this,"state",void 0),m(this,"pageSize",void 0),m(this,"type",void 0),m(this,"searchDebounced",void 0),m(this,"setDebounceOptions",(function(e){var t=e.debounceMs;n.searchDebounced=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.leading,i=void 0!==s&&s,a=r.trailing,o=void 0===a||a,c=null,u=null,l=function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];c?clearTimeout(c):i&&(t=e.apply(void 0,s)),o&&(u=s);var l=function(){u&&(t=e.apply(void 0,E(u)),u=null),c=null};return c=setTimeout(l,n),t};return l.cancel=function(){c&&clearTimeout(c)},l.flush=function(){return c&&(clearTimeout(c),c=null,u&&(t=e.apply(void 0,E(u)))),t},l}(n.executeQuery.bind(n),t)})),m(this,"activate",(function(){n.isActive||n.state.partialNext({isActive:!0})})),m(this,"deactivate",(function(){n.isActive&&n.state.partialNext({isActive:!1})})),m(this,"search",(function(e){n.searchDebounced(e)}));var r=ts(ts({},ns),t),s=r.debounceMs,i=r.pageSize;this.pageSize=i,this.state=new $n(this.initialState),this.setDebounceOptions({debounceMs:s})}var t;return g(e,[{key:"lastQueryError",get:function(){return this.state.getLatestValue().lastQueryError}},{key:"hasNext",get:function(){return this.state.getLatestValue().hasNext}},{key:"hasResults",get:function(){return Array.isArray(this.state.getLatestValue().items)}},{key:"isActive",get:function(){return this.state.getLatestValue().isActive}},{key:"isLoading",get:function(){return this.state.getLatestValue().isLoading}},{key:"initialState",get:function(){return{hasNext:!0,isActive:!1,isLoading:!1,items:void 0,lastQueryError:void 0,next:void 0,offset:0,searchQuery:""}}},{key:"items",get:function(){return this.state.getLatestValue().items}},{key:"next",get:function(){return this.state.getLatestValue().next}},{key:"offset",get:function(){return this.state.getLatestValue().offset}},{key:"searchQuery",get:function(){return this.state.getLatestValue().searchQuery}},{key:"executeQuery",value:(t=p(k.mark((function e(t){var n,r,s,i,a,o,c;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0!==t,r=null!=t?t:this.searchQuery,this.isActive&&!this.isLoading&&(this.hasNext||n)&&r){e.next=4;break}return e.abrupt("return");case 4:return n?this.state.next(ts(ts({},this.initialState),{},{isActive:this.isActive,isLoading:!0,searchQuery:null!=t?t:""})):this.state.partialNext({isLoading:!0}),s={},e.prev=6,e.next=9,this.query(r);case 9:if(i=e.sent){e.next=12;break}return e.abrupt("return");case 12:return a=i.items,(o=i.next)?(s.next=o,s.hasNext=!!o):(s.offset=(null!==(c=this.offset)&&void 0!==c?c:0)+a.length,s.hasNext=a.length===this.pageSize),e.next=16,this.filterQueryResults(a);case 16:s.items=e.sent,e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),s.lastQueryError=e.t0;case 22:return e.prev=22,this.state.next((function(e){var t;e.lastQueryError;var n=O(e,Yr);return ts(ts(ts({},n),s),{},{isLoading:!1,items:[].concat(E(null!==(t=n.items)&&void 0!==t?t:[]),E(s.items||[]))})})),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[6,19,22,25]])}))),function(e){return t.apply(this,arguments)})},{key:"resetState",value:function(){this.state.next(this.initialState)}}]),e}(),ss=function(e){Fn(r,e);var t,n=Zr(r);function r(e,t){var s;return f(this,r),m(Mn(s=n.call(this,t)),"type","users"),m(Mn(s),"client",void 0),m(Mn(s),"filters",void 0),m(Mn(s),"sort",void 0),m(Mn(s),"searchOptions",void 0),s.client=e,s}return g(r,[{key:"query",value:(t=p(k.mark((function e(t){var n,r,s,i,a;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ts({$or:[{id:{$autocomplete:t}},{name:{$autocomplete:t}}]},this.filters),r=ts({id:1},this.sort),s=ts(ts({},this.searchOptions),{},{limit:this.pageSize,offset:this.offset}),e.next=5,this.client.queryUsers(n,r,s);case 5:return i=e.sent,a=i.users,e.abrupt("return",{items:a});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"filterQueryResults",value:function(e){var t=this;return e.filter((function(e){var n;return e.id!==(null===(n=t.client.user)||void 0===n?void 0:n.id)}))}}]),r}(rs),is=function(e){Fn(r,e);var t,n=Zr(r);function r(e,t){var s;return f(this,r),m(Mn(s=n.call(this,t)),"type","channels"),m(Mn(s),"client",void 0),m(Mn(s),"filters",void 0),m(Mn(s),"sort",void 0),m(Mn(s),"searchOptions",void 0),s.client=e,s}return g(r,[{key:"query",value:(t=p(k.mark((function e(t){var n,r,s,i,a;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ts({members:{$in:[this.client.userID]},name:{$autocomplete:t}},this.filters),s=null!==(n=this.sort)&&void 0!==n?n:{},i=ts(ts({},this.searchOptions),{},{limit:this.pageSize,offset:this.offset}),e.next=5,this.client.queryChannels(r,s,i);case 5:return a=e.sent,e.abrupt("return",{items:a});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"filterQueryResults",value:function(e){return e}}]),r}(rs),as=function(e){Fn(r,e);var t,n=Zr(r);function r(e,t){var s;return f(this,r),m(Mn(s=n.call(this,t)),"type","messages"),m(Mn(s),"client",void 0),m(Mn(s),"messageSearchChannelFilters",void 0),m(Mn(s),"messageSearchFilters",void 0),m(Mn(s),"messageSearchSort",void 0),m(Mn(s),"channelQueryFilters",void 0),m(Mn(s),"channelQuerySort",void 0),m(Mn(s),"channelQueryOptions",void 0),s.client=e,s}return g(r,[{key:"query",value:(t=p(k.mark((function e(t){var n,r,s,i,a,o,c,u,l,h=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.userID){e.next=2;break}return e.abrupt("return",{items:[]});case 2:return n=ts({members:{$in:[this.client.userID]}},this.messageSearchChannelFilters),r=ts({text:t,type:"regular"},this.messageSearchFilters),s=ts({created_at:-1},this.messageSearchSort),i={limit:this.pageSize,next:this.next,sort:s},e.next=8,this.client.search(n,r,i);case 8:if(a=e.sent,o=a.next,c=a.results,u=c.map((function(e){return e.message})),0===(l=Array.from(u.reduce((function(e,t){return t.cid&&!h.client.activeChannels[t.cid]&&e.add(t.cid),e}),new Set))).length){e.next=17;break}return e.next=17,this.client.queryChannels(ts({cid:{$in:l}},this.channelQueryFilters),ts({last_message_at:-1},this.channelQuerySort),this.channelQueryOptions);case 17:return e.abrupt("return",{items:u,next:o});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"filterQueryResults",value:function(e){return e}}]),r}(rs),os=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.config,s=n.sources;f(this,e),m(this,"_internalState",void 0),m(this,"state",void 0),m(this,"config",void 0),m(this,"addSource",(function(e){t.state.partialNext({sources:[].concat(E(t.sources),[e])})})),m(this,"getSource",(function(e){return t.sources.find((function(t){return t.type===e}))})),m(this,"removeSource",(function(e){var n=t.sources.filter((function(t){return t.type!==e}));n.length!==t.sources.length&&t.state.partialNext({sources:n})})),m(this,"activateSource",(function(e){var n=t.getSource(e);n&&!n.isActive&&(t.config.keepSingleActiveSource&&t.sources.forEach((function(t){t.type!==e&&t.deactivate()})),n.activate(),t.state.partialNext({sources:E(t.sources)}))})),m(this,"deactivateSource",(function(e){var n=t.getSource(e);null!=n&&n.isActive&&1!==t.activeSources.length&&(n.deactivate(),t.state.partialNext({sources:E(t.sources)}))})),m(this,"activate",(function(){t.activeSources.length||(t.config.keepSingleActiveSource?t.sources.slice(0,1):t.sources).forEach((function(e){return e.activate()}));t.isActive||t.state.partialNext({isActive:!0})})),m(this,"search",function(){var e=p(k.mark((function e(n){var r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.activeSources,t.state.partialNext({searchQuery:n}),e.next=4,Promise.all(r.map((function(e){return e.search(n)})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(this,"cancelSearchQueries",(function(){t.activeSources.forEach((function(e){return e.searchDebounced.cancel()}))})),m(this,"clear",(function(){t.cancelSearchQueries(),t.sources.forEach((function(e){return e.state.next(ts(ts({},e.initialState),{},{isActive:e.isActive}))})),t.state.next((function(e){return ts(ts({},e),{},{isActive:!0,queriesInProgress:[],searchQuery:""})}))})),m(this,"exit",(function(){t.cancelSearchQueries(),t.sources.forEach((function(e){return e.state.next(ts(ts({},e.initialState),{},{isActive:e.isActive}))})),t.state.next((function(e){return ts(ts({},e),{},{isActive:!1,queriesInProgress:[],searchQuery:""})}))})),this.state=new $n({isActive:!1,searchQuery:"",sources:null!=s?s:[]}),this._internalState=new $n({}),this.config=ts({keepSingleActiveSource:!0},r)}return g(e,[{key:"hasNext",get:function(){return this.sources.some((function(e){return e.hasNext}))}},{key:"sources",get:function(){return this.state.getLatestValue().sources}},{key:"activeSources",get:function(){return this.state.getLatestValue().sources.filter((function(e){return e.isActive}))}},{key:"isActive",get:function(){return this.state.getLatestValue().isActive}},{key:"searchQuery",get:function(){return this.state.getLatestValue().searchQuery}},{key:"searchSourceTypes",get:function(){return this.sources.map((function(e){return e.type}))}}]),e}();e.Allow=zr,e.AllowAll=$r,e.AnyResource=Jr,e.AnyRole=Gr,e.BaseSearchSource=rs,e.BuiltinPermissions={AddLinks:"Add Links",BanUser:"Ban User",CreateChannel:"Create Channel",CreateMessage:"Create Message",CreateReaction:"Create Reaction",DeleteAnyAttachment:"Delete Any Attachment",DeleteAnyChannel:"Delete Any Channel",DeleteAnyMessage:"Delete Any Message",DeleteAnyReaction:"Delete Any Reaction",DeleteOwnAttachment:"Delete Own Attachment",DeleteOwnChannel:"Delete Own Channel",DeleteOwnMessage:"Delete Own Message",DeleteOwnReaction:"Delete Own Reaction",ReadAnyChannel:"Read Any Channel",ReadOwnChannel:"Read Own Channel",RunMessageAction:"Run Message Action",UpdateAnyChannel:"Update Any Channel",UpdateAnyMessage:"Update Any Message",UpdateMembersAnyChannel:"Update Members Any Channel",UpdateMembersOwnChannel:"Update Members Own Channel",UpdateOwnChannel:"Update Own Channel",UpdateOwnMessage:"Update Own Message",UploadAttachment:"Upload Attachment",UseFrozenChannel:"Send messages and reactions to frozen channels"},e.BuiltinRoles={Admin:"admin",Anonymous:"anonymous",ChannelMember:"channel_member",ChannelModerator:"channel_moderator",Guest:"guest",User:"user"},e.Campaign=x,e.Channel=en,e.ChannelManager=Mr,e.ChannelSearchSource=is,e.ChannelState=Kt,e.CheckSignature=Sn,e.ClientState=rn,e.DEFAULT_CHANNEL_MANAGER_OPTIONS=Tr,e.DEFAULT_CHANNEL_MANAGER_PAGINATION_OPTIONS=Dr,e.Deny=Qr,e.DenyAll=Xr,e.DevToken=Cn,e.EVENT_MAP={"channel.created":!0,"channel.deleted":!0,"channel.hidden":!0,"channel.kicked":!0,"channel.muted":!0,"channel.truncated":!0,"channel.unmuted":!0,"channel.updated":!0,"channel.visible":!0,"health.check":!0,"member.added":!0,"member.removed":!0,"member.updated":!0,"message.deleted":!0,"message.new":!0,"message.read":!0,"message.updated":!0,"message.undeleted":!0,"notification.added_to_channel":!0,"notification.channel_deleted":!0,"notification.channel_mutes_updated":!0,"notification.channel_truncated":!0,"notification.invite_accepted":!0,"notification.invite_rejected":!0,"notification.invited":!0,"notification.mark_read":!0,"notification.mark_unread":!0,"notification.message_new":!0,"notification.mutes_updated":!0,"notification.removed_from_channel":!0,"notification.thread_message_new":!0,"poll.closed":!0,"poll.updated":!0,"poll.vote_casted":!0,"poll.vote_changed":!0,"poll.vote_removed":!0,"reaction.deleted":!0,"reaction.new":!0,"reaction.updated":!0,"thread.updated":!0,"typing.start":!0,"typing.stop":!0,"user.banned":!0,"user.deleted":!0,"user.presence.changed":!0,"user.unbanned":!0,"user.unread_message_reminder":!0,"user.updated":!0,"user.watching.start":!0,"user.watching.stop":!0,"ai_indicator.update":!0,"ai_indicator.stop":!0,"ai_indicator.clear":!0,"channels.queried":!0,"connection.changed":!0,"connection.recovered":!0,"transport.changed":!0,"capabilities.changed":!0},e.ErrorFromResponse=Qn,e.InsightMetrics=un,e.JWTServerToken=kn,e.JWTUserToken=_n,e.MODERATION_ENTITY_TYPES=lr,e.MaxPriority=999,e.MessageSearchSource=as,e.MinPriority=1,e.Moderation=hr,e.Permission=Kr,e.Poll=xr,e.PollManager=Ar,e.SearchController=os,e.Segment=Dn,e.StableWSConnection=yn,e.StateStore=$n,e.StreamChat=Wr,e.THREAD_MANAGER_INITIAL_STATE=gr,e.Thread=sr,e.ThreadManager=mr,e.TokenManager=Rn,e.UserFromToken=xn,e.UserSearchSource=ss,e.buildWsFatalInsight=hn,e.buildWsSuccessAfterFailureInsight=pn,e.channelManagerEventToHandlerMapping=Lr,e.chatCodes=ft,e.decodeBase64=h,e.encodeBase64=l,e.extractPollData=Or,e.extractPollEnrichedData=Rr,e.formatMessage=Rt,e.isOwnUser=function(e){return void 0!==(null==e?void 0:e.total_unread_count)},e.isPatch=Kn,e.isVoteAnswer=kr,e.logChatPromiseExecution=ht,e.postInsights=ln,Object.defineProperty(e,"__esModule",{value:!0})}(this.window=this.window||{});
//# sourceMappingURL=browser.full-bundle.min.js.map
